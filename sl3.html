<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 6 Super (Machine) Learning | Targeted Learning in R</title>
<meta name="author" content="Mark van der Laan, Jeremy Coyle, Nima Hejazi, Ivana Malenica, Rachael Phillips, Alan Hubbard">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4.9002/tabs.js"></script><script src="libs/bs3compat-0.2.4.9002/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/vis-4.20.1/vis.css" rel="stylesheet">
<script src="libs/vis-4.20.1/vis.min.js"></script><script src="libs/visNetwork-binding-2.0.9/visNetwork.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Causal Data Science with the tlverse Software Ecosystem">Targeted Learning in R</a>:
        <small class="text-muted">Causal Data Science with the tlverse Software Ecosystem</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">About this book</a></li>
<li><a class="" href="robust.html"><span class="header-section-number">1</span> Robust Statistics and Reproducible Science</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">2</span> The Roadmap for Targeted Learning</a></li>
<li><a class="" href="tlverse.html"><span class="header-section-number">3</span> Welcome to the tlverse</a></li>
<li><a class="" href="data.html"><span class="header-section-number">4</span> Meet the Data</a></li>
<li><a class="" href="origami.html"><span class="header-section-number">5</span> Cross-validation</a></li>
<li><a class="active" href="sl3.html"><span class="header-section-number">6</span> Super (Machine) Learning</a></li>
<li><a class="" href="tmle3.html"><span class="header-section-number">7</span> The TMLE Framework</a></li>
<li><a class="" href="optimal-individualized-treatment-regimes.html"><span class="header-section-number">8</span> Optimal Individualized Treatment Regimes</a></li>
<li><a class="" href="stochastic-treatment-regimes.html"><span class="header-section-number">9</span> Stochastic Treatment Regimes</a></li>
<li><a class="" href="r6.html"><span class="header-section-number">10</span> A Primer on the R6 Class System</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/tlverse/tlverse-handbook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="sl3" class="section level1">
<h1>
<span class="header-section-number">6</span> Super (Machine) Learning<a class="anchor" aria-label="anchor" href="#sl3"><i class="fas fa-link"></i></a>
</h1>
<p><em>Rachael Phillips</em></p>
<p>Based on the <a href="https://github.com/tlverse/sl3"><code>sl3</code> <code>R</code> package</a> by <em>Jeremy
Coyle, Nima Hejazi, Ivana Malenica, Rachael Phillips, and Oleg Sofrygin</em>.</p>
<p>Updated: 2021-02-22</p>
<div id="learning-objectives-3" class="section level2 unnumbered">
<h2>Learning Objectives<a class="anchor" aria-label="anchor" href="#learning-objectives-3"><i class="fas fa-link"></i></a>
</h2>
<p>By the end of this chapter you will be able to:</p>
<ol style="list-style-type: decimal">
<li>Select a loss function that is appropriate for the functional parameter to be
estimated.</li>
<li>Assemble an ensemble of learners based on the properties that identify what
features they support.</li>
<li>Customize learner hyperparameters to incorporate a diversity of different
settings.</li>
<li>Select a subset of available covariates and pass only those variables to the
modeling algorithm.</li>
<li>Fit an ensemble with nested cross-validation to obtain an estimate of the
performance of the ensemble itself.</li>
<li>Obtain <code>sl3</code> variable importance metrics.</li>
<li>Interpret the discrete and continuous Super Learner fits.</li>
<li>Rationalize the need to remove bias from the Super Learner to make an optimal
bias–variance tradeoff for the parameter of interest.</li>
</ol>
</div>
<div id="motivation" class="section level2 unnumbered">
<h2>Motivation<a class="anchor" aria-label="anchor" href="#motivation"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>A common task in data analysis is prediction — using the observed data to
learn a function, which can be used to map new input variables into a
predicted outcome. <!--  Oftentimes, the scientific question of interest translates 
  to a statistical question that requires (causal) effect estimation. Even in 
  these scenarios, where prediction is not in the forefront, there are Often
  prediction steps embedded in the procedure. --->
</li>
<li>For some data, algorithms that can model a complex function are necessary to<br>
adequately model the data. For other data, a main terms regression model might
fit the data quite well.<br>
</li>
<li>The Super Learner, an ensemble learner, solves this issue, by allowing a
combination of algorithms from the simplest (intercept-only) to most complex
(neural nets, random forests, SVM, etc).</li>
<li>It works by using cross-validation in a manner which guarantees that the
resulting fit will be as good as possible, given the learners provided.</li>
</ul>
</div>
<div id="introduction-2" class="section level2 unnumbered">
<h2>Introduction<a class="anchor" aria-label="anchor" href="#introduction-2"><i class="fas fa-link"></i></a>
</h2>
<p>In <a href="intro.html#intro">Chapter 1</a>, we introduced the <a href="intro.html#roadmap"><em>Roadmap for Targeted
Learning</em></a> as a general template to translate real-world data
applications into formal statistical estimation problems. The first steps of
this roadmap define the <em>statistical estimation problem</em>, which establish</p>
<ol style="list-style-type: decimal">
<li>Data as a random variable, or equivalently, a realization of a
particular experiment/study. We assume the observations in the data are
independent and identically distributed.</li>
<li>A statistical model as the set of possible probability distributions that
could have given rise to the observed data.</li>
<li>A translation of the scientific question, which is often causal, into a
target estimand.</li>
</ol>
<p>Note that if the estimand is causal, step 3 also requires establishing
identifiability of the estimand from the observed data, under possible
non-testable assumptions that may not necessarily be reasonable. Still, the
target quantity does have a valid statistical interpretation. See <a href="intro.html#causal">causal target
parameters</a> for more detail on causal models and identifiability.</p>
<p>Now that we have defined the statistical estimation problem, we are ready to
construct the TMLE; an asymptotically linear and efficient substitution
estimator of this estimand. The first step in this estimation procedure
is an initial estimate of the data-generating distribution, or the relevant part
of this distribution that is needed to evaluate the target parameter. For this
initial estimation, we use the Super Learner <span class="citation">(van der Laan, Polley, and Hubbard <a href="references.html#ref-vdl2007super">2007</a>)</span>.</p>
<p>The Super Learner provides an important step in creating a robust estimator. It
is a loss-function-based tool that uses cross-validation to obtain the best
prediction of our target parameter, based on a weighted average of a library of
machine learning algorithms. The library of machine learning algorithms
consists of functions (“learners” in the <code>sl3</code> nomenclature) that we think might
be consistent with the true data-generating distribution. By “consistent with
the true data-generating distribution”, we mean that the algorithms selected
should not violate subject-matter knowledge about the experiment that
generated the data. Also, the library should contain a diversity of algorithms
that range from parametric regression models to multi-step algorithms involving
screening covariates, penalizations, optimizing tuning parameters, etc.</p>
<p>The ensembling of the collection of algorithms with weights (“metalearning” in
the <code>sl3</code> nomenclature) has been shown to be adaptive and robust, even in small
samples <span class="citation">(Polley and van der Laan <a href="references.html#ref-polley2010super">2010</a>)</span>. The Super Learner is proven to be asymptotically as
accurate as the best possible prediction algorithm in the library
<span class="citation">(van der Laan and Dudoit <a href="references.html#ref-vdl2003unified">2003</a>; Van der Vaart, Dudoit, and Laan <a href="references.html#ref-vaart2006oracle">2006</a>)</span>.</p>
<div id="background-1" class="section level3 unnumbered">
<h3>Background<a class="anchor" aria-label="anchor" href="#background-1"><i class="fas fa-link"></i></a>
</h3>
<p>We use a <em>loss function</em> <span class="math inline">\(L\)</span> to assign a measure of performance to each
candidate learner <span class="math inline">\(\psi\)</span> when applied to the data <span class="math inline">\(O\)</span>, and subsequently compare
performance across the learners. More generally, <span class="math inline">\(L\)</span> maps every
<span class="math inline">\(\psi \in \mathbb{R}\)</span> to <span class="math inline">\(L(\psi) : (O) \mapsto L(\psi)(O)\)</span>. It is important
to recall that <span class="math inline">\(\psi\)</span> is an estimator of <span class="math inline">\(\psi_0\)</span>, the unknown and true
parameter value under <span class="math inline">\(P_0\)</span>. A valid loss function will have expectation (risk)
that is minimized at the true value of the parameter <span class="math inline">\(\psi_0\)</span>. Minimizing the
expected loss will bring the chosen candidate closer to the true <span class="math inline">\(\psi_0\)</span>. For
example, say we observe a learning data set <span class="math inline">\(O_i=(Y_i,X_i)\)</span>, of <span class="math inline">\(i=1, ..., n\)</span>
independent and identically distributed observations, where <span class="math inline">\(Y_i\)</span> is a
continuous outcome of interest, <span class="math inline">\(X_i\)</span> is a set of covariates, and our objective
is to estimate the function <span class="math inline">\(\psi_0: X \mapsto \psi_0(X) = E_0(Y|X)\)</span>. This
function can be expressed as the minimizer of the expected squared error loss:
<span class="math inline">\(\psi_0 = \text{argmin}_{\psi} E[L(O,\psi(X))]\)</span>, where
<span class="math inline">\(L(O,\psi(X)) = (Y − \psi(X))^2\)</span>. We can estimate the loss by substituting the
empirical distribution of the data <span class="math inline">\(P_n\)</span> for the true and unknown distribution
of the observed data <span class="math inline">\(P_0\)</span>. Also, we can use the cross-validated risk to
empirically determine the relative performance of the candidate learners. Once
we have tested different algorithms on actual data and looked at the performance
(e.g., MSE of predictions across all learners), we can see which algorithm has
the lowest risk, and thus is closest to the true <span class="math inline">\(\psi_0\)</span>.</p>
<p>The <em>cross-validated empirical risk</em> of an algorithm is defined as the empirical
mean over a validation sample of the loss of the algorithm fitted on the
training sample, averaged across the splits of the data.</p>
<p>The <em>discrete Super Learner</em>, or <em>cross-validation selector</em>, is the algorithm
in the library that minimizes the cross-validated empirical risk.</p>
<p>The <em>continuous/ensemble Super Learner</em>, often referred to as <em>Super Learner</em>
is a weighted average of the library of algorithms, where the weights are chosen
to minimize the cross-validated empirical risk of the library. Restricting the
weights to be positive and sum to one (i.e., a convex combination) has been
shown to improve upon the discrete Super Learner <span class="citation">(Polley and van der Laan <a href="references.html#ref-polley2010super">2010</a>; van der Laan, Polley, and Hubbard <a href="references.html#ref-vdl2007super">2007</a>)</span>. This notion of weighted combinations was introduced in
<span class="citation">Wolpert (<a href="references.html#ref-wolpert1992stacked">1992</a>)</span> for neural networks and adapted for regressions in
<span class="citation">Breiman (<a href="references.html#ref-breiman1996stacked">1996</a>)</span>.</p>
<p>Cross-validation is proven to be optimal for selection among estimators. This
result was established through the oracle inequality for the cross-validation
selector among a collection of candidate estimators <span class="citation">(van der Laan and Dudoit <a href="references.html#ref-vdl2003unified">2003</a>; Van der Vaart, Dudoit, and Laan <a href="references.html#ref-vaart2006oracle">2006</a>)</span>. The only condition is that loss function is uniformly
bounded, which is guaranteed in <code>sl3</code>.</p>
<!--
The *oracle results* prove that, if the number of algorithms in the library are
polynomial in sample size, then the cross-validation selector (i.e., discrete
Super Learner) (1) is equivalent with the oracle selector asymptotically (based
on sample of size of training samples), or (2) achieves the parametric rate
(log $n/n$) for convergence with respect to the loss-based dissimilarity (risk)
between a candidate estimate $\psi$ and the true parameter value $\psi_0$.


### Super Learner for Prediction {-}

Below, we show the results of
such a study, comparing the fits of several different learners, including the SL
algorithms.

r cv_fig3, results="asis", echo = FALSE
knitr::include_graphics("img/misc/ericSL.pdf")


For more detail on Super Learner we refer the reader to @vdl2007super and
@polley2010super. The optimality results for the cross-validation selector
among a family of algorithms were established in @vdl2003unified and extended
in @vaart2006oracle.
-->
</div>
</div>
<div id="sl3-microwave-dinner-implementation" class="section level2 unnumbered">
<h2>
<code>sl3</code> “Microwave Dinner” Implementation<a class="anchor" aria-label="anchor" href="#sl3-microwave-dinner-implementation"><i class="fas fa-link"></i></a>
</h2>
<p>We begin by illustrating the core functionality of the super learner algorithm
as implemented in <code>sl3</code>.</p>
<p>The <code>sl3</code> implementation consists of the following steps:</p>
<ol start="0" style="list-style-type: decimal">
<li>Load the necessary libraries and data</li>
<li>Define the machine learning task</li>
<li>Make a super learner by creating library of base learners and a metalearner</li>
<li>Train the super learner on the machine learning task</li>
<li>Obtain predicted values</li>
</ol>
<div id="wash-benefits-study-example-1" class="section level3 unnumbered">
<h3>WASH Benefits Study Example<a class="anchor" aria-label="anchor" href="#wash-benefits-study-example-1"><i class="fas fa-link"></i></a>
</h3>
<p>Using the WASH data, we are interested in predicting weight-for-height z-score
<code>whz</code> using the available covariate data. More information on this dataset, and
all other data that we will work with in this handbook, is contained in <span id="data">Chapter
3</span>. Let’s begin!</p>
</div>
<div id="load-the-necessary-libraries-and-data" class="section level3 unnumbered">
<h3>0. Load the necessary libraries and data<a class="anchor" aria-label="anchor" href="#load-the-necessary-libraries-and-data"><i class="fas fa-link"></i></a>
</h3>
<p>First, we will load the relevant <code>R</code> packages, set a seed, and load the data.</p>
<!--
If you would like to use newer `sl3` functionality that is available in the
devel branch of the `sl3` GitHub repository, you need to install that version
of the package (i.e., `usethis::install_github(tlverse/sl3@devel)`), re-start
your `R` session, and then re-load the `sl3` package.
-->
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ecpolley/SuperLearner">SuperLearner</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tlverse.org/origami">origami</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tlverse.org/sl3">sl3</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/">kableExtra</a></span><span class="op">)</span>

<span class="co"># load data set and take a peek</span>
<span class="va">washb_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
    <span class="st">"https://raw.githubusercontent.com/tlverse/tlverse-data/master/"</span>,
    <span class="st">"wash-benefits/washb_data.csv"</span>
  <span class="op">)</span>,
  stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">washb_data</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kableExtra</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>fixed_thead <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/scroll_box.html">scroll_box</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="st">"300px"</span><span class="op">)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">
<div class="inline-table"><table class="table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
whz
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
tr
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
fracode
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
month
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
aged
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
sex
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
momage
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
momedu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
momheight
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
hfiacat
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Nlt18
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
Ncomp
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
watmin
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
elec
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
floor
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
walls
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
roof
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_wardrobe
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_table
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_chair
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_khat
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_chouki
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_tv
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_refrig
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_bike
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_moto
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_sewmach
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
asset_mobile
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N05265
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
268
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
30
</td>
<td style="text-align:left;">
Primary (1-5y)
</td>
<td style="text-align:right;">
146.40
</td>
<td style="text-align:left;">
Food Secure
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.16
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N05265
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
286
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
Primary (1-5y)
</td>
<td style="text-align:right;">
148.75
</td>
<td style="text-align:left;">
Moderately Food Insecure
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.05
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N08002
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
264
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
25
</td>
<td style="text-align:left;">
Primary (1-5y)
</td>
<td style="text-align:right;">
152.15
</td>
<td style="text-align:left;">
Food Secure
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
10
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-1.26
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N08002
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
252
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
28
</td>
<td style="text-align:left;">
Primary (1-5y)
</td>
<td style="text-align:right;">
140.25
</td>
<td style="text-align:left;">
Food Secure
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.59
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N06531
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
336
</td>
<td style="text-align:left;">
female
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:left;">
Secondary (&gt;5y)
</td>
<td style="text-align:right;">
150.95
</td>
<td style="text-align:left;">
Food Secure
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
-0.51
</td>
<td style="text-align:left;">
Control
</td>
<td style="text-align:left;">
N06531
</td>
<td style="text-align:right;">
9
</td>
<td style="text-align:right;">
304
</td>
<td style="text-align:left;">
male
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:left;">
Secondary (&gt;5y)
</td>
<td style="text-align:right;">
154.20
</td>
<td style="text-align:left;">
Severely Food Insecure
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="define-the-machine-learning-task" class="section level3 unnumbered">
<h3>1. Define the machine learning task<a class="anchor" aria-label="anchor" href="#define-the-machine-learning-task"><i class="fas fa-link"></i></a>
</h3>
<p>To define the machine learning <strong>“task”</strong> (predict weight-for-height Z-score
<code>whz</code> using the available covariate data), we need to create an <code>sl3_Task</code>
object.</p>
<p>The <code>sl3_Task</code> keeps track of the roles the variables play in the machine
learning problem, the data, and any metadata (e.g., observational-level weights,
IDs, offset).</p>
<p>Also, if we had missing outcomes, we would need to set <code>drop_missing_outcome = TRUE</code> when we create the task. In the next analysis, with the <a href="data.html#ist">IST stroke trial
data</a>, we do have a missing outcome. In the following chapter, we need to
estimate this “missingness mechanism”; which is the conditional probably that
the outcome is observed, given the history (i.e., variables that were measured
before the missingness). Estimating the missingness mechanism requires learning
a prediction function that outputs the predicted probability that a unit
is missing, given their history.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># specify the outcome and covariates</span>
<span class="va">outcome</span> <span class="op">&lt;-</span> <span class="st">"whz"</span>
<span class="va">covars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">washb_data</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">washb_data</span><span class="op">)</span> <span class="op">==</span> <span class="va">outcome</span><span class="op">)</span><span class="op">]</span>

<span class="co"># create the sl3 task</span>
<span class="va">washb_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/sl3_Task.html">make_sl3_Task</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">washb_data</span>,
  covariates <span class="op">=</span> <span class="va">covars</span>,
  outcome <span class="op">=</span> <span class="va">outcome</span>
<span class="op">)</span>
<span class="co">#&gt; Warning in process_data(data, nodes, column_names = column_names, flag = flag, :</span>
<span class="co">#&gt; Missing covariate data detected: imputing covariates.</span></code></pre></div>
<p><em>This warning is important.</em> The task just imputed missing covariates for us.
Specifically, for each covariate column with missing values, <code>sl3</code> uses the
median to impute missing continuous covariates, and the mode to impute binary
and categorical covariates.</p>
<p>Also, for each covariate column with missing values, <code>sl3</code> adds an additional
column indicating whether or not the value was imputed, which is particularly
handy when the missingness in the data might be informative.</p>
<p>Also, notice that we did not specify the number of folds, or the loss function
in the task. The default cross-validation scheme is V-fold, with <span class="math inline">\(V=10\)</span> number
of folds.</p>
<p>Let’s visualize our <code>washb_task</code>:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">washb_task</span>
<span class="co">#&gt; A sl3 Task with 4695 obs and these nodes:</span>
<span class="co">#&gt; $covariates</span>
<span class="co">#&gt;  [1] "tr"              "fracode"         "month"           "aged"           </span>
<span class="co">#&gt;  [5] "sex"             "momage"          "momedu"          "momheight"      </span>
<span class="co">#&gt;  [9] "hfiacat"         "Nlt18"           "Ncomp"           "watmin"         </span>
<span class="co">#&gt; [13] "elec"            "floor"           "walls"           "roof"           </span>
<span class="co">#&gt; [17] "asset_wardrobe"  "asset_table"     "asset_chair"     "asset_khat"     </span>
<span class="co">#&gt; [21] "asset_chouki"    "asset_tv"        "asset_refrig"    "asset_bike"     </span>
<span class="co">#&gt; [25] "asset_moto"      "asset_sewmach"   "asset_mobile"    "delta_momage"   </span>
<span class="co">#&gt; [29] "delta_momheight"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $outcome</span>
<span class="co">#&gt; [1] "whz"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $id</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $weights</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $offset</span>
<span class="co">#&gt; NULL</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $time</span>
<span class="co">#&gt; NULL</span></code></pre></div>
<p>We can’t see when we print the task, but the default cross-validation fold
structure (<span class="math inline">\(V\)</span>-fold cross-validation with <span class="math inline">\(V\)</span>=10 folds) was created when we
defined the task.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">washb_task</span><span class="op">$</span><span class="va">folds</span><span class="op">)</span> <span class="co"># how many folds?</span>
<span class="co">#&gt; [1] 10</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">washb_task</span><span class="op">$</span><span class="va">folds</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">training_set</span><span class="op">)</span> <span class="co"># row indexes for fold 1 training</span>
<span class="co">#&gt; [1] 1 2 3 4 5 6</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">washb_task</span><span class="op">$</span><span class="va">folds</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">validation_set</span><span class="op">)</span> <span class="co"># row indexes for fold 1 validation</span>
<span class="co">#&gt; [1] 12 21 29 41 43 53</span>

<span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span><span class="op">(</span><span class="va">washb_task</span><span class="op">$</span><span class="va">folds</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">training_set</span> <span class="op">%in%</span> <span class="va">washb_task</span><span class="op">$</span><span class="va">folds</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">validation_set</span><span class="op">)</span>
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p><code>R6</code> Tip: If you type <code>washb_task$</code> and then press the “tab” button (you will
need to press “tab” twice if you’re not in RStudio), you can view all of the
active and public fields and methods that can be accessed from the <code>washb_task</code>
object.</p>
</div>
<div id="make-a-super-learner" class="section level3 unnumbered">
<h3>2. Make a Super Learner<a class="anchor" aria-label="anchor" href="#make-a-super-learner"><i class="fas fa-link"></i></a>
</h3>
<p>Now that we have defined our machine learning problem with the <code>sl3_Task</code>, we
are ready to <strong>“make”</strong> the Super Learner. This requires specification of</p>
<ul>
<li>A set of candidate machine learning algorithms, also commonly referred to as
a “library” of “learners”. The set should include a diversity of algorithms
that are believed to be consistent with the true data-generating distribution.</li>
<li>A metalearner, to ensemble the base learners.</li>
</ul>
<p>We might also incorporate</p>
<ul>
<li>Feature selection, to pass only a subset of the predictors to the algorithm.</li>
<li>Hyperparameter specification, to tune base learners.</li>
</ul>
<p>Learners have properties that indicate what features they support. We may use
<code><a href="https://tlverse.org/sl3/reference/list_learners.html">sl3_list_properties()</a></code> to get a list of all properties supported by at least
one learner.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tlverse.org/sl3/reference/list_learners.html">sl3_list_properties</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;  [1] "binomial"      "categorical"   "continuous"    "cv"           </span>
<span class="co">#&gt;  [5] "density"       "ids"           "importance"    "offset"       </span>
<span class="co">#&gt;  [9] "preprocessing" "sampling"      "screener"      "timeseries"   </span>
<span class="co">#&gt; [13] "weights"       "wrapper"</span></code></pre></div>
<p>Since we have a continuous outcome, we may identify the learners that support
this outcome type with <code><a href="https://tlverse.org/sl3/reference/list_learners.html">sl3_list_learners()</a></code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tlverse.org/sl3/reference/list_learners.html">sl3_list_learners</a></span><span class="op">(</span><span class="st">"continuous"</span><span class="op">)</span>
<span class="co">#&gt;  [1] "Lrnr_arima"                     "Lrnr_bartMachine"              </span>
<span class="co">#&gt;  [3] "Lrnr_bilstm"                    "Lrnr_bound"                    </span>
<span class="co">#&gt;  [5] "Lrnr_caret"                     "Lrnr_cv_selector"              </span>
<span class="co">#&gt;  [7] "Lrnr_dbarts"                    "Lrnr_earth"                    </span>
<span class="co">#&gt;  [9] "Lrnr_expSmooth"                 "Lrnr_gam"                      </span>
<span class="co">#&gt; [11] "Lrnr_gbm"                       "Lrnr_glm"                      </span>
<span class="co">#&gt; [13] "Lrnr_glm_fast"                  "Lrnr_glmnet"                   </span>
<span class="co">#&gt; [15] "Lrnr_grf"                       "Lrnr_gru_keras"                </span>
<span class="co">#&gt; [17] "Lrnr_gts"                       "Lrnr_h2o_glm"                  </span>
<span class="co">#&gt; [19] "Lrnr_h2o_grid"                  "Lrnr_hal9001"                  </span>
<span class="co">#&gt; [21] "Lrnr_HarmonicReg"               "Lrnr_hts"                      </span>
<span class="co">#&gt; [23] "Lrnr_lstm"                      "Lrnr_lstm_keras"               </span>
<span class="co">#&gt; [25] "Lrnr_mean"                      "Lrnr_multiple_ts"              </span>
<span class="co">#&gt; [27] "Lrnr_nnet"                      "Lrnr_nnls"                     </span>
<span class="co">#&gt; [29] "Lrnr_optim"                     "Lrnr_pkg_SuperLearner"         </span>
<span class="co">#&gt; [31] "Lrnr_pkg_SuperLearner_method"   "Lrnr_pkg_SuperLearner_screener"</span>
<span class="co">#&gt; [33] "Lrnr_polspline"                 "Lrnr_randomForest"             </span>
<span class="co">#&gt; [35] "Lrnr_ranger"                    "Lrnr_rpart"                    </span>
<span class="co">#&gt; [37] "Lrnr_rugarch"                   "Lrnr_screener_correlation"     </span>
<span class="co">#&gt; [39] "Lrnr_solnp"                     "Lrnr_stratified"               </span>
<span class="co">#&gt; [41] "Lrnr_svm"                       "Lrnr_tsDyn"                    </span>
<span class="co">#&gt; [43] "Lrnr_xgboost"</span></code></pre></div>
<p>Now that we have an idea of some learners, we can construct them using the
<code>make_learner</code> function or the <code>new</code> method.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># choose base learners</span>
<span class="va">lrnr_glm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Lrnr_glm</span><span class="op">)</span>
<span class="va">lrnr_mean</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_mean.html">Lrnr_mean</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We can customize learner hyperparameters to incorporate a diversity of different
settings. Documentation for the learners and their hyperparameters can be found
in the <a href="https://tlverse.org/sl3/reference/index.html#section-sl-learners"><code>sl3</code> Learners
Reference</a>.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lrnr_ranger50</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Lrnr_ranger</span>, num.trees <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>
<span class="va">lrnr_hal_faster</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_hal9001.html">Lrnr_hal9001</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>max_degree <span class="op">=</span> <span class="fl">2</span>, reduce_basis <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>
<span class="va">lrnr_lasso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Lrnr_glmnet</span><span class="op">)</span> <span class="co"># alpha default is 1</span>
<span class="va">lrnr_ridge</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">lrnr_elasticnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Lrnr_glmnet</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">xgb_fast</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_xgboost.html">Lrnr_xgboost</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We can also include learners from the <code>SuperLearner</code> <code>R</code> package.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lrnr_bayesglm</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/SuperLearner_interface.html">Lrnr_pkg_SuperLearner</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="st">"SL.bayesglm"</span><span class="op">)</span></code></pre></div>
<p>Here is a fun trick to create customized learners over a grid of parameters.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># I like to crock pot my super learners</span>
<span class="va">grid_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">1000</span><span class="op">)</span>,
  gamma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span>,
  kernel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"polynomial"</span>, <span class="st">"radial"</span>, <span class="st">"sigmoid"</span><span class="op">)</span>,
  degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="va">grid_params</span>, KEEP.OUT.ATTRS <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">svm_learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">grid</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">tuning_params</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">Lrnr_svm</span><span class="op">$</span><span class="va">new</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">tuning_params</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grid_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  max_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span><span class="op">)</span>,
  eta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span>,
  nrounds <span class="op">=</span> <span class="fl">100</span>
<span class="op">)</span>
<span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="va">grid_params</span>, KEEP.OUT.ATTRS <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">xgb_learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">grid</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">tuning_params</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">Lrnr_xgboost</span><span class="op">$</span><span class="va">new</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">tuning_params</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>Did you see <code>Lrnr_caret</code> when we called <code><a href="https://tlverse.org/sl3/reference/list_learners.html">sl3_list_learners(c("binomial"))</a></code>?
All we need to specify to use this popular algorithm as a candidate in our
Super Learner is the <code>algorithm</code> we want to tune, which is passed as
<code>method</code> to <code><a href="https://rdrr.io/pkg/caret/man/train.html">caret::train()</a></code>. The default method for parameter selection
criterion with is set to “CV” instead of the <code><a href="https://rdrr.io/pkg/caret/man/train.html">caret::train()</a></code> default <code>boot</code>.
The summary metric used to select the optimal model is <code>RMSE</code> for continuous
outcomes and <code>Accuracy</code> for categorical and binomial outcomes.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Unlike xgboost, I have no idea how to tune a neural net or BART machine, so</span>
<span class="co"># I let caret take the reins</span>
<span class="va">lrnr_caret_nnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Lrnr_caret</span>, algorithm <span class="op">=</span> <span class="st">"nnet"</span><span class="op">)</span>
<span class="va">lrnr_caret_bartMachine</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Lrnr_caret</span>,
  algorithm <span class="op">=</span> <span class="st">"bartMachine"</span>,
  method <span class="op">=</span> <span class="st">"boot"</span>, metric <span class="op">=</span> <span class="st">"Accuracy"</span>,
  tuneLength <span class="op">=</span> <span class="fl">10</span>
<span class="op">)</span></code></pre></div>
<p>In order to assemble the library of learners, we need to <strong>“stack”</strong> them
together.</p>
<p>A <code>Stack</code> is a special learner and it has the same interface as all other
learners. What makes a stack special is that it combines multiple learners by
training them simultaneously, so that their predictions can be either combined
or compared.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Stack</span>, <span class="va">lrnr_glm</span>, <span class="va">lrnr_ridge</span>, <span class="va">lrnr_lasso</span>, <span class="va">xgb_fast</span><span class="op">)</span>
<span class="va">stack</span>
<span class="co">#&gt; [1] "Lrnr_glm_TRUE"                          </span>
<span class="co">#&gt; [2] "Lrnr_glmnet_NULL_deviance_10_0_100_TRUE"</span>
<span class="co">#&gt; [3] "Lrnr_glmnet_NULL_deviance_10_1_100_TRUE"</span>
<span class="co">#&gt; [4] "Lrnr_xgboost_20_1"</span></code></pre></div>
<p>We can also stack the learners by first creating a vector, and then
instantiating the stack. I prefer this method, since it easily allows us to
modify the names of the learners.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># named vector of learners first</span>
<span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lrnr_glm</span>, <span class="va">lrnr_ridge</span>, <span class="va">lrnr_lasso</span>, <span class="va">xgb_fast</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">learners</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"glm"</span>, <span class="st">"ridge"</span>, <span class="st">"lasso"</span>, <span class="st">"xgboost"</span><span class="op">)</span>
<span class="co"># next make the stack</span>
<span class="va">stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Stack</span>, <span class="va">learners</span><span class="op">)</span>
<span class="co"># now the names are pretty</span>
<span class="va">stack</span>
<span class="co">#&gt; [1] "glm"     "ridge"   "lasso"   "xgboost"</span></code></pre></div>
<p>We’re jumping ahead a bit, but let’s check something out quickly. It’s
straightforward, and just one more step, to set up this stack such that
all of the learners will train in a cross-validated manner.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cv_stack</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_cv.html">Lrnr_cv</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">stack</span><span class="op">)</span>
<span class="va">cv_stack</span>
<span class="co">#&gt; [1] "Lrnr_cv"</span>
<span class="co">#&gt; [1] "glm"     "ridge"   "lasso"   "xgboost"</span></code></pre></div>
<div id="screening-algorithms-for-feature-selection" class="section level4 unnumbered">
<h4>Screening Algorithms for Feature Selection<a class="anchor" aria-label="anchor" href="#screening-algorithms-for-feature-selection"><i class="fas fa-link"></i></a>
</h4>
<p>We can optionally select a subset of available covariates and pass only
those variables to the modeling algorithm. The current set of learners that
can be used for prescreening covariates is included below.</p>
<ul>
<li>
<code>Lrnr_screener_importance</code> selects <code>num_screen</code> (default = 5) covariates
based on the variable importance ranking provided by the <code>learner</code>. Any
learner with an “importance” method can be used in <code>Lrnr_screener_importance</code>;
and this currently includes <code>Lrnr_ranger</code>, <code>Lrnr_randomForest</code>, and
<code>Lrnr_xgboost</code>.</li>
<li>
<code>Lrnr_screener_coefs</code>, which provides screening of covariates based on the
magnitude of their estimated coefficients in a (possibly regularized) GLM.
The <code>threshold</code> (default = 1e-3) defines the minimum absolute size of the
coefficients, and thus covariates, to be kept. Also, a <code>max_retain</code> argument
can be optionally provided to restrict the number of selected covariates to be
no more than <code>max_retain</code>.</li>
<li>
<code>Lrnr_screener_correlation</code> provides covariate screening procedures by
running a test of correlation (Pearson default), and then selecting the (1)
top ranked variables (default), or (2) the variables with a pvalue lower than
some pre-specified threshold.</li>
<li>
<code>Lrnr_screener_augment</code> augments a set of screened covariates with additional<br>
covariates that should be included by default, even if the screener did not
select them. An example of how to use this screener is included below.</li>
</ul>
<p>Let’s consider screening covariates based on their <code>randomForest</code> variable
importance ranking (ordered by mean decrease in accuracy). To select the top
5 most important covariates according to this ranking, we can combine
<code>Lrnr_screener_importance</code> with <code>Lrnr_ranger</code> (limiting the number of trees by
setting <code>ntree = 20</code>).</p>
<p>Hang on! Before you think it – I will confess: Bob Ross and I both know that 20
trees makes for a lonely forest, and I shouldn’t even consider it, but these are
the sacrifices I have to make for this chapter to build in a timely manner!</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">miniforest</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  num.trees <span class="op">=</span> <span class="fl">20</span>, write.forest <span class="op">=</span> <span class="cn">FALSE</span>,
  importance <span class="op">=</span> <span class="st">"impurity_corrected"</span>
<span class="op">)</span>

<span class="co"># learner must already be instantiated, we did this when we created miniforest</span>
<span class="va">screen_rf</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_screener_importance.html">Lrnr_screener_importance</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>learner <span class="op">=</span> <span class="va">miniforest</span>, num_screen <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">screen_rf</span>
<span class="co">#&gt; [1] "Lrnr_screener_importance_5"</span>

<span class="co"># which covariates are selected on the full data?</span>
<span class="va">screen_rf</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">washb_task</span><span class="op">)</span>
<span class="co">#&gt; [1] "Lrnr_screener_importance_5"</span>
<span class="co">#&gt; $selected</span>
<span class="co">#&gt; [1] "aged"        "month"       "momedu"      "asset_tv"    "asset_chair"</span></code></pre></div>
<p>An example of how to format <code>Lrnr_screener_augment</code> is included below for
clarity.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">keepme</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"aged"</span>, <span class="st">"momage"</span><span class="op">)</span>
<span class="co"># screener must already be instantiated, we did this when we created screen_rf</span>
<span class="va">screen_augment_rf</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_screener_augment.html">Lrnr_screener_augment</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  screener <span class="op">=</span> <span class="va">screen_rf</span>, default_covariates <span class="op">=</span> <span class="va">keepme</span>
<span class="op">)</span>
<span class="va">screen_augment_rf</span>
<span class="co">#&gt; [1] "Lrnr_screener_augment_c(\"aged\", \"momage\")"</span></code></pre></div>
<p>To <strong>“pipe”</strong> only the selected covariates to the modeling algorithm, we need to
make a <code>Pipeline</code>, which is a just set of learners to be fit sequentially, where
the fit from one learner is used to define the task for the next learner.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">screen_rf_pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Pipeline</span>, <span class="va">screen_rf</span>, <span class="va">stack</span><span class="op">)</span></code></pre></div>
<p>Now our learners will be preceded by a screening step.</p>
<p>We also consider the original <code>stack</code>, to compare how the feature selection
methods perform in comparison to the methods without feature selection, and
because</p>
<p>Analogous to what we have seen before, we have to stack the pipeline and
original <code>stack</code> together, so we may use them as base learners in our super
learner.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># pretty names again</span>
<span class="va">learners2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">learners</span>, <span class="va">screen_rf_pipeline</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">learners2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">learners</span><span class="op">)</span>, <span class="st">"rf_screen"</span><span class="op">)</span>

<span class="va">fancy_stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Stack</span>, <span class="va">learners2</span><span class="op">)</span>
<span class="va">fancy_stack</span>
<span class="co">#&gt; [1] "glm"       "ridge"     "lasso"     "xgboost"   "rf_screen"</span>

<span class="co"># we can visualize the stack</span>
<span class="va">dt_stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/learner_helpers.html">delayed_learner_train</a></span><span class="op">(</span><span class="va">fancy_stack</span>, <span class="va">washb_task</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dt_stack</span>, color <span class="op">=</span> <span class="cn">FALSE</span>, height <span class="op">=</span> <span class="st">"400px"</span>, width <span class="op">=</span> <span class="st">"90%"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-64e31bdf0964cb796022" style="width:90%;height:400px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-64e31bdf0964cb796022">{"x":{"nodes":{"id":["4c6b1274-7546-11eb-a124-42010a1e01f6","4c6b02ac-7546-11eb-a124-42010a1e01f6","4c69b6c2-7546-11eb-a124-42010a1e01f6","4c69c96e-7546-11eb-a124-42010a1e01f6","4c69db02-7546-11eb-a124-42010a1e01f6","4c69eb92-7546-11eb-a124-42010a1e01f6","4c6af104-7546-11eb-a124-42010a1e01f6","4c6ae29a-7546-11eb-a124-42010a1e01f6","4c69ffc4-7546-11eb-a124-42010a1e01f6","4c6ac2b0-7546-11eb-a124-42010a1e01f6","4c6a118a-7546-11eb-a124-42010a1e01f6","4c6ab2a2-7546-11eb-a124-42010a1e01f6","4c6a4218-7546-11eb-a124-42010a1e01f6","4c6a222e-7546-11eb-a124-42010a1e01f6","4c6a60c2-7546-11eb-a124-42010a1e01f6","4c6a7f1c-7546-11eb-a124-42010a1e01f6","4c6a9dc6-7546-11eb-a124-42010a1e01f6"],"label":["Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1"],"level":[1,2,3,3,3,3,3,4,10,5,9,6,7,8,7,7,7],"sequential":[true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false],"state":["waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting"],"group":["none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none"]},"edges":{"from":["4c69b6c2-7546-11eb-a124-42010a1e01f6","4c69c96e-7546-11eb-a124-42010a1e01f6","4c69db02-7546-11eb-a124-42010a1e01f6","4c69eb92-7546-11eb-a124-42010a1e01f6","4c69ffc4-7546-11eb-a124-42010a1e01f6","4c69ffc4-7546-11eb-a124-42010a1e01f6","4c6a118a-7546-11eb-a124-42010a1e01f6","4c6a118a-7546-11eb-a124-42010a1e01f6","4c6a222e-7546-11eb-a124-42010a1e01f6","4c6a4218-7546-11eb-a124-42010a1e01f6","4c6a222e-7546-11eb-a124-42010a1e01f6","4c6a60c2-7546-11eb-a124-42010a1e01f6","4c6a222e-7546-11eb-a124-42010a1e01f6","4c6a7f1c-7546-11eb-a124-42010a1e01f6","4c6a222e-7546-11eb-a124-42010a1e01f6","4c6a9dc6-7546-11eb-a124-42010a1e01f6","4c6ab2a2-7546-11eb-a124-42010a1e01f6","4c6ac2b0-7546-11eb-a124-42010a1e01f6","4c6ae29a-7546-11eb-a124-42010a1e01f6","4c6af104-7546-11eb-a124-42010a1e01f6","4c6b02ac-7546-11eb-a124-42010a1e01f6"],"to":["4c6b02ac-7546-11eb-a124-42010a1e01f6","4c6b02ac-7546-11eb-a124-42010a1e01f6","4c6b02ac-7546-11eb-a124-42010a1e01f6","4c6b02ac-7546-11eb-a124-42010a1e01f6","4c6ae29a-7546-11eb-a124-42010a1e01f6","4c6a118a-7546-11eb-a124-42010a1e01f6","4c6ac2b0-7546-11eb-a124-42010a1e01f6","4c6a222e-7546-11eb-a124-42010a1e01f6","4c6a4218-7546-11eb-a124-42010a1e01f6","4c6ab2a2-7546-11eb-a124-42010a1e01f6","4c6a60c2-7546-11eb-a124-42010a1e01f6","4c6ab2a2-7546-11eb-a124-42010a1e01f6","4c6a7f1c-7546-11eb-a124-42010a1e01f6","4c6ab2a2-7546-11eb-a124-42010a1e01f6","4c6a9dc6-7546-11eb-a124-42010a1e01f6","4c6ab2a2-7546-11eb-a124-42010a1e01f6","4c6ac2b0-7546-11eb-a124-42010a1e01f6","4c6ae29a-7546-11eb-a124-42010a1e01f6","4c6af104-7546-11eb-a124-42010a1e01f6","4c6b02ac-7546-11eb-a124-42010a1e01f6","4c6b1274-7546-11eb-a124-42010a1e01f6"],"label":["","","","","","","","","","","","","","","","","","","","",""]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"edges":{"arrows":"to"},"layout":{"hierarchical":{"enabled":true,"levelSeparation":500,"nodeSpacing":200,"direction":"RL"}},"groups":{"useDefaultGroups":true,"none":{"color":{"border":"black","background":"white"}}}},"groups":["none"],"width":"90%","height":"400px","idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)"},"evals":[],"jsHooks":[]}</script><p>We will use the <a href="https://github.com/tlverse/sl3/blob/master/R/default_metalearner.R">default
metalearner</a>,
which uses
<a href="https://github.com/tlverse/sl3/blob/master/R/Lrnr_solnp.R"><code>Lrnr_solnp()</code></a> to
provide fitting procedures for a pairing of <a href="https://github.com/tlverse/sl3/blob/master/R/loss_functions.R">loss
function</a> and
<a href="https://github.com/tlverse/sl3/blob/master/R/metalearners.R">metalearner
function</a>. This
default metalearner selects a loss and metalearner pairing based on the outcome
type. Note that any learner can be used as a metalearner.</p>
<p>We have made a library/stack of base learners, so we are ready to make the super
learner. The super learner algorithm fits a metalearner on the validation-set
predictions.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Lrnr_sl</span>, learners <span class="op">=</span> <span class="va">fancy_stack</span><span class="op">)</span></code></pre></div>
<p>We can also use <code>Lrnr_cv</code> to build a super learner, cross-validate a stack of
learners to compare performance of the learners in the stack, or cross-validate
any single learner (see “Cross-validation” section of this <a href="https://tlverse.org/sl3/articles/intro_sl3.html"><code>sl3</code>
introductory tutorial</a>).</p>
<p>Furthermore, we can <a href="https://tlverse.org/sl3/articles/custom_lrnrs.html">Define New <code>sl3</code>
Learners</a> which can be used
in all the places you could otherwise use any other <code>sl3</code> learners, including
<code>Pipelines</code>, <code>Stacks</code>, and the Super Learner.</p>
<p>In the plot below, we visualize the steps for executing the Super Learner in the
<code>tlverse/delayed</code> framework. For those like myself who are not particularly
keen on understanding the intricacies of <code>delayed</code>, let’s focus on the main
point of this figure: we can see there are 10 realizations of the stack which
represent the 10 cross-validation folds and there is a separate hold-out
(top branch of the figure) that will not be used to fit the Super Learner.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dt_sl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/learner_helpers.html">delayed_learner_train</a></span><span class="op">(</span><span class="va">sl</span>, <span class="va">washb_task</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">dt_sl</span>, color <span class="op">=</span> <span class="cn">FALSE</span>, height <span class="op">=</span> <span class="st">"400px"</span>, width <span class="op">=</span> <span class="st">"90%"</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-67a25aaeb9b7ad2830f5" style="width:90%;height:400px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-67a25aaeb9b7ad2830f5">{"x":{"nodes":{"id":["4ca58684-7546-11eb-a124-42010a1e01f6","4ca57824-7546-11eb-a124-42010a1e01f6","4ca539a4-7546-11eb-a124-42010a1e01f6","4ca52b8a-7546-11eb-a124-42010a1e01f6","4c7bd640-7546-11eb-a124-42010a1e01f6","4c7bc664-7546-11eb-a124-42010a1e01f6","4c79a154-7546-11eb-a124-42010a1e01f6","4c79b540-7546-11eb-a124-42010a1e01f6","4c79c6a2-7546-11eb-a124-42010a1e01f6","4c79d98a-7546-11eb-a124-42010a1e01f6","4c7bb4e4-7546-11eb-a124-42010a1e01f6","4c7ba5da-7546-11eb-a124-42010a1e01f6","4c7ad06a-7546-11eb-a124-42010a1e01f6","4c7b8b0e-7546-11eb-a124-42010a1e01f6","4c7adeca-7546-11eb-a124-42010a1e01f6","4c7b7c7c-7546-11eb-a124-42010a1e01f6","4c7b0f44-7546-11eb-a124-42010a1e01f6","4c7af05e-7546-11eb-a124-42010a1e01f6","4c7b2ce0-7546-11eb-a124-42010a1e01f6","4c7b4e6e-7546-11eb-a124-42010a1e01f6","4c7b6dea-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4c8274be-7546-11eb-a124-42010a1e01f6","4c826596-7546-11eb-a124-42010a1e01f6","4c8128ca-7546-11eb-a124-42010a1e01f6","4c813c02-7546-11eb-a124-42010a1e01f6","4c814d3c-7546-11eb-a124-42010a1e01f6","4c815dcc-7546-11eb-a124-42010a1e01f6","4c8252c2-7546-11eb-a124-42010a1e01f6","4c82441c-7546-11eb-a124-42010a1e01f6","4c817280-7546-11eb-a124-42010a1e01f6","4c82273e-7546-11eb-a124-42010a1e01f6","4c817f5a-7546-11eb-a124-42010a1e01f6","4c8217bc-7546-11eb-a124-42010a1e01f6","4c81ac3c-7546-11eb-a124-42010a1e01f6","4c818e6e-7546-11eb-a124-42010a1e01f6","4c81ca3c-7546-11eb-a124-42010a1e01f6","4c81e828-7546-11eb-a124-42010a1e01f6","4c8207b8-7546-11eb-a124-42010a1e01f6","4c94a5e4-7546-11eb-a124-42010a1e01f6","4c949676-7546-11eb-a124-42010a1e01f6","4c9356a8-7546-11eb-a124-42010a1e01f6","4c936aa8-7546-11eb-a124-42010a1e01f6","4c937cb4-7546-11eb-a124-42010a1e01f6","4c938d44-7546-11eb-a124-42010a1e01f6","4c94855a-7546-11eb-a124-42010a1e01f6","4c9476e6-7546-11eb-a124-42010a1e01f6","4c93a072-7546-11eb-a124-42010a1e01f6","4c945bd4-7546-11eb-a124-42010a1e01f6","4c93ad56-7546-11eb-a124-42010a1e01f6","4c944c52-7546-11eb-a124-42010a1e01f6","4c93dc2c-7546-11eb-a124-42010a1e01f6","4c93be68-7546-11eb-a124-42010a1e01f6","4c93ff18-7546-11eb-a124-42010a1e01f6","4c941e6c-7546-11eb-a124-42010a1e01f6","4c943d48-7546-11eb-a124-42010a1e01f6","4c968a44-7546-11eb-a124-42010a1e01f6","4c967b30-7546-11eb-a124-42010a1e01f6","4c954440-7546-11eb-a124-42010a1e01f6","4c9555a2-7546-11eb-a124-42010a1e01f6","4c95660a-7546-11eb-a124-42010a1e01f6","4c9576fe-7546-11eb-a124-42010a1e01f6","4c966938-7546-11eb-a124-42010a1e01f6","4c965934-7546-11eb-a124-42010a1e01f6","4c958a5e-7546-11eb-a124-42010a1e01f6","4c963de6-7546-11eb-a124-42010a1e01f6","4c9597e2-7546-11eb-a124-42010a1e01f6","4c962e46-7546-11eb-a124-42010a1e01f6","4c95c550-7546-11eb-a124-42010a1e01f6","4c95a764-7546-11eb-a124-42010a1e01f6","4c95e314-7546-11eb-a124-42010a1e01f6","4c96007e-7546-11eb-a124-42010a1e01f6","4c961e38-7546-11eb-a124-42010a1e01f6","4c987188-7546-11eb-a124-42010a1e01f6","4c985edc-7546-11eb-a124-42010a1e01f6","4c972828-7546-11eb-a124-42010a1e01f6","4c97391c-7546-11eb-a124-42010a1e01f6","4c9749e8-7546-11eb-a124-42010a1e01f6","4c975b0e-7546-11eb-a124-42010a1e01f6","4c984cd0-7546-11eb-a124-42010a1e01f6","4c983f24-7546-11eb-a124-42010a1e01f6","4c976eaa-7546-11eb-a124-42010a1e01f6","4c982340-7546-11eb-a124-42010a1e01f6","4c977b7a-7546-11eb-a124-42010a1e01f6","4c98149a-7546-11eb-a124-42010a1e01f6","4c97a960-7546-11eb-a124-42010a1e01f6","4c978b56-7546-11eb-a124-42010a1e01f6","4c97c882-7546-11eb-a124-42010a1e01f6","4c97e678-7546-11eb-a124-42010a1e01f6","4c98063a-7546-11eb-a124-42010a1e01f6","4c9a5f98-7546-11eb-a124-42010a1e01f6","4c9a507a-7546-11eb-a124-42010a1e01f6","4c9913b8-7546-11eb-a124-42010a1e01f6","4c9925a6-7546-11eb-a124-42010a1e01f6","4c9938e8-7546-11eb-a124-42010a1e01f6","4c994b12-7546-11eb-a124-42010a1e01f6","4c9a3e8c-7546-11eb-a124-42010a1e01f6","4c9a30cc-7546-11eb-a124-42010a1e01f6","4c995f58-7546-11eb-a124-42010a1e01f6","4c9a160a-7546-11eb-a124-42010a1e01f6","4c996c8c-7546-11eb-a124-42010a1e01f6","4c9a0750-7546-11eb-a124-42010a1e01f6","4c999acc-7546-11eb-a124-42010a1e01f6","4c997d08-7546-11eb-a124-42010a1e01f6","4c99b8e0-7546-11eb-a124-42010a1e01f6","4c99da0a-7546-11eb-a124-42010a1e01f6","4c99f828-7546-11eb-a124-42010a1e01f6","4c9c4e34-7546-11eb-a124-42010a1e01f6","4c9c3e26-7546-11eb-a124-42010a1e01f6","4c9aff98-7546-11eb-a124-42010a1e01f6","4c9b150a-7546-11eb-a124-42010a1e01f6","4c9b25d6-7546-11eb-a124-42010a1e01f6","4c9b36c0-7546-11eb-a124-42010a1e01f6","4c9c2c1a-7546-11eb-a124-42010a1e01f6","4c9c1d38-7546-11eb-a124-42010a1e01f6","4c9b4958-7546-11eb-a124-42010a1e01f6","4c9c028a-7546-11eb-a124-42010a1e01f6","4c9b565a-7546-11eb-a124-42010a1e01f6","4c9bf380-7546-11eb-a124-42010a1e01f6","4c9b8922-7546-11eb-a124-42010a1e01f6","4c9b6a5a-7546-11eb-a124-42010a1e01f6","4c9ba8e4-7546-11eb-a124-42010a1e01f6","4c9bc6f8-7546-11eb-a124-42010a1e01f6","4c9be516-7546-11eb-a124-42010a1e01f6","4c9e3bc2-7546-11eb-a124-42010a1e01f6","4c9e2cd6-7546-11eb-a124-42010a1e01f6","4c9ced26-7546-11eb-a124-42010a1e01f6","4c9cff00-7546-11eb-a124-42010a1e01f6","4c9d103a-7546-11eb-a124-42010a1e01f6","4c9d2084-7546-11eb-a124-42010a1e01f6","4c9e1b24-7546-11eb-a124-42010a1e01f6","4c9e0b84-7546-11eb-a124-42010a1e01f6","4c9d33c6-7546-11eb-a124-42010a1e01f6","4c9deeb0-7546-11eb-a124-42010a1e01f6","4c9d40e6-7546-11eb-a124-42010a1e01f6","4c9de028-7546-11eb-a124-42010a1e01f6","4c9d735e-7546-11eb-a124-42010a1e01f6","4c9d5022-7546-11eb-a124-42010a1e01f6","4c9d928a-7546-11eb-a124-42010a1e01f6","4c9db0bc-7546-11eb-a124-42010a1e01f6","4c9dd114-7546-11eb-a124-42010a1e01f6","4ca1349e-7546-11eb-a124-42010a1e01f6","4ca11ea0-7546-11eb-a124-42010a1e01f6","4c9ed8fc-7546-11eb-a124-42010a1e01f6","4c9eec20-7546-11eb-a124-42010a1e01f6","4c9efcd8-7546-11eb-a124-42010a1e01f6","4c9f0dea-7546-11eb-a124-42010a1e01f6","4c9fff52-7546-11eb-a124-42010a1e01f6","4c9ff124-7546-11eb-a124-42010a1e01f6","4c9f2078-7546-11eb-a124-42010a1e01f6","4c9fd50e-7546-11eb-a124-42010a1e01f6","4c9f2dfc-7546-11eb-a124-42010a1e01f6","4c9fc62c-7546-11eb-a124-42010a1e01f6","4c9f5c82-7546-11eb-a124-42010a1e01f6","4c9f3d06-7546-11eb-a124-42010a1e01f6","4c9f7a8c-7546-11eb-a124-42010a1e01f6","4c9f99ea-7546-11eb-a124-42010a1e01f6","4c9fb7c2-7546-11eb-a124-42010a1e01f6","4ca3245c-7546-11eb-a124-42010a1e01f6","4ca314ee-7546-11eb-a124-42010a1e01f6","4ca1d840-7546-11eb-a124-42010a1e01f6","4ca1eace-7546-11eb-a124-42010a1e01f6","4ca1fb7c-7546-11eb-a124-42010a1e01f6","4ca20ba8-7546-11eb-a124-42010a1e01f6","4ca303c8-7546-11eb-a124-42010a1e01f6","4ca2f4b4-7546-11eb-a124-42010a1e01f6","4ca21ecc-7546-11eb-a124-42010a1e01f6","4ca2d7b8-7546-11eb-a124-42010a1e01f6","4ca22b9c-7546-11eb-a124-42010a1e01f6","4ca2c80e-7546-11eb-a124-42010a1e01f6","4ca25bda-7546-11eb-a124-42010a1e01f6","4ca23bbe-7546-11eb-a124-42010a1e01f6","4ca27b38-7546-11eb-a124-42010a1e01f6","4ca29ab4-7546-11eb-a124-42010a1e01f6","4ca2b968-7546-11eb-a124-42010a1e01f6","4ca50d08-7546-11eb-a124-42010a1e01f6","4ca4fdf4-7546-11eb-a124-42010a1e01f6","4ca3c362-7546-11eb-a124-42010a1e01f6","4ca3d4ce-7546-11eb-a124-42010a1e01f6","4ca3e612-7546-11eb-a124-42010a1e01f6","4ca3f788-7546-11eb-a124-42010a1e01f6","4ca4ec38-7546-11eb-a124-42010a1e01f6","4ca4de3c-7546-11eb-a124-42010a1e01f6","4ca40a2a-7546-11eb-a124-42010a1e01f6","4ca4c0fa-7546-11eb-a124-42010a1e01f6","4ca4184e-7546-11eb-a124-42010a1e01f6","4ca4b236-7546-11eb-a124-42010a1e01f6","4ca4477e-7546-11eb-a124-42010a1e01f6","4ca42776-7546-11eb-a124-42010a1e01f6","4ca4663c-7546-11eb-a124-42010a1e01f6","4ca48478-7546-11eb-a124-42010a1e01f6","4ca4a26e-7546-11eb-a124-42010a1e01f6","4ca54868-7546-11eb-a124-42010a1e01f6","4ca56672-7546-11eb-a124-42010a1e01f6"],"label":["CV_","bundle","CV_Stack","bundle","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","bundle","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Stack","bundle","Lrnr_glm_TRUE","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","Pipeline(Lrnr_screener_importance_5->Stack)","bundle","Lrnr_screener_importance_5","Stack","chain","bundle","Lrnr_glm_TRUE","subset","Lrnr_glmnet_NULL_deviance_10_0_100_TRUE","Lrnr_glmnet_NULL_deviance_10_1_100_TRUE","Lrnr_xgboost_20_1","chain","Lrnr_solnp_TRUE_TRUE_FALSE_1e-05"],"level":[1,2,5,6,7,8,9,9,9,9,9,10,16,11,15,12,13,14,13,13,13,7,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,8,9,10,10,10,10,10,11,17,12,16,13,14,15,14,14,14,4,3],"sequential":[true,true,true,true,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,true,false,false,false,false,true,true,false,true,true,true,false,false,false,false,false,true,false],"state":["waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","ready","ready","ready","ready","waiting","waiting","ready","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting","waiting"],"group":["none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none","none"]},"edges":{"from":["4c79a154-7546-11eb-a124-42010a1e01f6","4c79b540-7546-11eb-a124-42010a1e01f6","4c79c6a2-7546-11eb-a124-42010a1e01f6","4c79d98a-7546-11eb-a124-42010a1e01f6","4c7ad06a-7546-11eb-a124-42010a1e01f6","4c7ad06a-7546-11eb-a124-42010a1e01f6","4c7adeca-7546-11eb-a124-42010a1e01f6","4c7adeca-7546-11eb-a124-42010a1e01f6","4c7af05e-7546-11eb-a124-42010a1e01f6","4c7b0f44-7546-11eb-a124-42010a1e01f6","4c7af05e-7546-11eb-a124-42010a1e01f6","4c7b2ce0-7546-11eb-a124-42010a1e01f6","4c7af05e-7546-11eb-a124-42010a1e01f6","4c7b4e6e-7546-11eb-a124-42010a1e01f6","4c7af05e-7546-11eb-a124-42010a1e01f6","4c7b6dea-7546-11eb-a124-42010a1e01f6","4c7b7c7c-7546-11eb-a124-42010a1e01f6","4c7b8b0e-7546-11eb-a124-42010a1e01f6","4c7ba5da-7546-11eb-a124-42010a1e01f6","4c7bb4e4-7546-11eb-a124-42010a1e01f6","4c7bc664-7546-11eb-a124-42010a1e01f6","4c7bd640-7546-11eb-a124-42010a1e01f6","4c8128ca-7546-11eb-a124-42010a1e01f6","4c813c02-7546-11eb-a124-42010a1e01f6","4c814d3c-7546-11eb-a124-42010a1e01f6","4c815dcc-7546-11eb-a124-42010a1e01f6","4c817280-7546-11eb-a124-42010a1e01f6","4c817280-7546-11eb-a124-42010a1e01f6","4c817f5a-7546-11eb-a124-42010a1e01f6","4c817f5a-7546-11eb-a124-42010a1e01f6","4c818e6e-7546-11eb-a124-42010a1e01f6","4c81ac3c-7546-11eb-a124-42010a1e01f6","4c818e6e-7546-11eb-a124-42010a1e01f6","4c81ca3c-7546-11eb-a124-42010a1e01f6","4c818e6e-7546-11eb-a124-42010a1e01f6","4c81e828-7546-11eb-a124-42010a1e01f6","4c818e6e-7546-11eb-a124-42010a1e01f6","4c8207b8-7546-11eb-a124-42010a1e01f6","4c8217bc-7546-11eb-a124-42010a1e01f6","4c82273e-7546-11eb-a124-42010a1e01f6","4c82441c-7546-11eb-a124-42010a1e01f6","4c8252c2-7546-11eb-a124-42010a1e01f6","4c826596-7546-11eb-a124-42010a1e01f6","4c8274be-7546-11eb-a124-42010a1e01f6","4c9356a8-7546-11eb-a124-42010a1e01f6","4c936aa8-7546-11eb-a124-42010a1e01f6","4c937cb4-7546-11eb-a124-42010a1e01f6","4c938d44-7546-11eb-a124-42010a1e01f6","4c93a072-7546-11eb-a124-42010a1e01f6","4c93a072-7546-11eb-a124-42010a1e01f6","4c93ad56-7546-11eb-a124-42010a1e01f6","4c93ad56-7546-11eb-a124-42010a1e01f6","4c93be68-7546-11eb-a124-42010a1e01f6","4c93dc2c-7546-11eb-a124-42010a1e01f6","4c93be68-7546-11eb-a124-42010a1e01f6","4c93ff18-7546-11eb-a124-42010a1e01f6","4c93be68-7546-11eb-a124-42010a1e01f6","4c941e6c-7546-11eb-a124-42010a1e01f6","4c93be68-7546-11eb-a124-42010a1e01f6","4c943d48-7546-11eb-a124-42010a1e01f6","4c944c52-7546-11eb-a124-42010a1e01f6","4c945bd4-7546-11eb-a124-42010a1e01f6","4c9476e6-7546-11eb-a124-42010a1e01f6","4c94855a-7546-11eb-a124-42010a1e01f6","4c949676-7546-11eb-a124-42010a1e01f6","4c94a5e4-7546-11eb-a124-42010a1e01f6","4c954440-7546-11eb-a124-42010a1e01f6","4c9555a2-7546-11eb-a124-42010a1e01f6","4c95660a-7546-11eb-a124-42010a1e01f6","4c9576fe-7546-11eb-a124-42010a1e01f6","4c958a5e-7546-11eb-a124-42010a1e01f6","4c958a5e-7546-11eb-a124-42010a1e01f6","4c9597e2-7546-11eb-a124-42010a1e01f6","4c9597e2-7546-11eb-a124-42010a1e01f6","4c95a764-7546-11eb-a124-42010a1e01f6","4c95c550-7546-11eb-a124-42010a1e01f6","4c95a764-7546-11eb-a124-42010a1e01f6","4c95e314-7546-11eb-a124-42010a1e01f6","4c95a764-7546-11eb-a124-42010a1e01f6","4c96007e-7546-11eb-a124-42010a1e01f6","4c95a764-7546-11eb-a124-42010a1e01f6","4c961e38-7546-11eb-a124-42010a1e01f6","4c962e46-7546-11eb-a124-42010a1e01f6","4c963de6-7546-11eb-a124-42010a1e01f6","4c965934-7546-11eb-a124-42010a1e01f6","4c966938-7546-11eb-a124-42010a1e01f6","4c967b30-7546-11eb-a124-42010a1e01f6","4c968a44-7546-11eb-a124-42010a1e01f6","4c972828-7546-11eb-a124-42010a1e01f6","4c97391c-7546-11eb-a124-42010a1e01f6","4c9749e8-7546-11eb-a124-42010a1e01f6","4c975b0e-7546-11eb-a124-42010a1e01f6","4c976eaa-7546-11eb-a124-42010a1e01f6","4c976eaa-7546-11eb-a124-42010a1e01f6","4c977b7a-7546-11eb-a124-42010a1e01f6","4c977b7a-7546-11eb-a124-42010a1e01f6","4c978b56-7546-11eb-a124-42010a1e01f6","4c97a960-7546-11eb-a124-42010a1e01f6","4c978b56-7546-11eb-a124-42010a1e01f6","4c97c882-7546-11eb-a124-42010a1e01f6","4c978b56-7546-11eb-a124-42010a1e01f6","4c97e678-7546-11eb-a124-42010a1e01f6","4c978b56-7546-11eb-a124-42010a1e01f6","4c98063a-7546-11eb-a124-42010a1e01f6","4c98149a-7546-11eb-a124-42010a1e01f6","4c982340-7546-11eb-a124-42010a1e01f6","4c983f24-7546-11eb-a124-42010a1e01f6","4c984cd0-7546-11eb-a124-42010a1e01f6","4c985edc-7546-11eb-a124-42010a1e01f6","4c987188-7546-11eb-a124-42010a1e01f6","4c9913b8-7546-11eb-a124-42010a1e01f6","4c9925a6-7546-11eb-a124-42010a1e01f6","4c9938e8-7546-11eb-a124-42010a1e01f6","4c994b12-7546-11eb-a124-42010a1e01f6","4c995f58-7546-11eb-a124-42010a1e01f6","4c995f58-7546-11eb-a124-42010a1e01f6","4c996c8c-7546-11eb-a124-42010a1e01f6","4c996c8c-7546-11eb-a124-42010a1e01f6","4c997d08-7546-11eb-a124-42010a1e01f6","4c999acc-7546-11eb-a124-42010a1e01f6","4c997d08-7546-11eb-a124-42010a1e01f6","4c99b8e0-7546-11eb-a124-42010a1e01f6","4c997d08-7546-11eb-a124-42010a1e01f6","4c99da0a-7546-11eb-a124-42010a1e01f6","4c997d08-7546-11eb-a124-42010a1e01f6","4c99f828-7546-11eb-a124-42010a1e01f6","4c9a0750-7546-11eb-a124-42010a1e01f6","4c9a160a-7546-11eb-a124-42010a1e01f6","4c9a30cc-7546-11eb-a124-42010a1e01f6","4c9a3e8c-7546-11eb-a124-42010a1e01f6","4c9a507a-7546-11eb-a124-42010a1e01f6","4c9a5f98-7546-11eb-a124-42010a1e01f6","4c9aff98-7546-11eb-a124-42010a1e01f6","4c9b150a-7546-11eb-a124-42010a1e01f6","4c9b25d6-7546-11eb-a124-42010a1e01f6","4c9b36c0-7546-11eb-a124-42010a1e01f6","4c9b4958-7546-11eb-a124-42010a1e01f6","4c9b4958-7546-11eb-a124-42010a1e01f6","4c9b565a-7546-11eb-a124-42010a1e01f6","4c9b565a-7546-11eb-a124-42010a1e01f6","4c9b6a5a-7546-11eb-a124-42010a1e01f6","4c9b8922-7546-11eb-a124-42010a1e01f6","4c9b6a5a-7546-11eb-a124-42010a1e01f6","4c9ba8e4-7546-11eb-a124-42010a1e01f6","4c9b6a5a-7546-11eb-a124-42010a1e01f6","4c9bc6f8-7546-11eb-a124-42010a1e01f6","4c9b6a5a-7546-11eb-a124-42010a1e01f6","4c9be516-7546-11eb-a124-42010a1e01f6","4c9bf380-7546-11eb-a124-42010a1e01f6","4c9c028a-7546-11eb-a124-42010a1e01f6","4c9c1d38-7546-11eb-a124-42010a1e01f6","4c9c2c1a-7546-11eb-a124-42010a1e01f6","4c9c3e26-7546-11eb-a124-42010a1e01f6","4c9c4e34-7546-11eb-a124-42010a1e01f6","4c9ced26-7546-11eb-a124-42010a1e01f6","4c9cff00-7546-11eb-a124-42010a1e01f6","4c9d103a-7546-11eb-a124-42010a1e01f6","4c9d2084-7546-11eb-a124-42010a1e01f6","4c9d33c6-7546-11eb-a124-42010a1e01f6","4c9d33c6-7546-11eb-a124-42010a1e01f6","4c9d40e6-7546-11eb-a124-42010a1e01f6","4c9d40e6-7546-11eb-a124-42010a1e01f6","4c9d5022-7546-11eb-a124-42010a1e01f6","4c9d735e-7546-11eb-a124-42010a1e01f6","4c9d5022-7546-11eb-a124-42010a1e01f6","4c9d928a-7546-11eb-a124-42010a1e01f6","4c9d5022-7546-11eb-a124-42010a1e01f6","4c9db0bc-7546-11eb-a124-42010a1e01f6","4c9d5022-7546-11eb-a124-42010a1e01f6","4c9dd114-7546-11eb-a124-42010a1e01f6","4c9de028-7546-11eb-a124-42010a1e01f6","4c9deeb0-7546-11eb-a124-42010a1e01f6","4c9e0b84-7546-11eb-a124-42010a1e01f6","4c9e1b24-7546-11eb-a124-42010a1e01f6","4c9e2cd6-7546-11eb-a124-42010a1e01f6","4c9e3bc2-7546-11eb-a124-42010a1e01f6","4c9ed8fc-7546-11eb-a124-42010a1e01f6","4c9eec20-7546-11eb-a124-42010a1e01f6","4c9efcd8-7546-11eb-a124-42010a1e01f6","4c9f0dea-7546-11eb-a124-42010a1e01f6","4c9f2078-7546-11eb-a124-42010a1e01f6","4c9f2078-7546-11eb-a124-42010a1e01f6","4c9f2dfc-7546-11eb-a124-42010a1e01f6","4c9f2dfc-7546-11eb-a124-42010a1e01f6","4c9f3d06-7546-11eb-a124-42010a1e01f6","4c9f5c82-7546-11eb-a124-42010a1e01f6","4c9f3d06-7546-11eb-a124-42010a1e01f6","4c9f7a8c-7546-11eb-a124-42010a1e01f6","4c9f3d06-7546-11eb-a124-42010a1e01f6","4c9f99ea-7546-11eb-a124-42010a1e01f6","4c9f3d06-7546-11eb-a124-42010a1e01f6","4c9fb7c2-7546-11eb-a124-42010a1e01f6","4c9fc62c-7546-11eb-a124-42010a1e01f6","4c9fd50e-7546-11eb-a124-42010a1e01f6","4c9ff124-7546-11eb-a124-42010a1e01f6","4c9fff52-7546-11eb-a124-42010a1e01f6","4ca11ea0-7546-11eb-a124-42010a1e01f6","4ca1349e-7546-11eb-a124-42010a1e01f6","4ca1d840-7546-11eb-a124-42010a1e01f6","4ca1eace-7546-11eb-a124-42010a1e01f6","4ca1fb7c-7546-11eb-a124-42010a1e01f6","4ca20ba8-7546-11eb-a124-42010a1e01f6","4ca21ecc-7546-11eb-a124-42010a1e01f6","4ca21ecc-7546-11eb-a124-42010a1e01f6","4ca22b9c-7546-11eb-a124-42010a1e01f6","4ca22b9c-7546-11eb-a124-42010a1e01f6","4ca23bbe-7546-11eb-a124-42010a1e01f6","4ca25bda-7546-11eb-a124-42010a1e01f6","4ca23bbe-7546-11eb-a124-42010a1e01f6","4ca27b38-7546-11eb-a124-42010a1e01f6","4ca23bbe-7546-11eb-a124-42010a1e01f6","4ca29ab4-7546-11eb-a124-42010a1e01f6","4ca23bbe-7546-11eb-a124-42010a1e01f6","4ca2b968-7546-11eb-a124-42010a1e01f6","4ca2c80e-7546-11eb-a124-42010a1e01f6","4ca2d7b8-7546-11eb-a124-42010a1e01f6","4ca2f4b4-7546-11eb-a124-42010a1e01f6","4ca303c8-7546-11eb-a124-42010a1e01f6","4ca314ee-7546-11eb-a124-42010a1e01f6","4ca3245c-7546-11eb-a124-42010a1e01f6","4ca3c362-7546-11eb-a124-42010a1e01f6","4ca3d4ce-7546-11eb-a124-42010a1e01f6","4ca3e612-7546-11eb-a124-42010a1e01f6","4ca3f788-7546-11eb-a124-42010a1e01f6","4ca40a2a-7546-11eb-a124-42010a1e01f6","4ca40a2a-7546-11eb-a124-42010a1e01f6","4ca4184e-7546-11eb-a124-42010a1e01f6","4ca4184e-7546-11eb-a124-42010a1e01f6","4ca42776-7546-11eb-a124-42010a1e01f6","4ca4477e-7546-11eb-a124-42010a1e01f6","4ca42776-7546-11eb-a124-42010a1e01f6","4ca4663c-7546-11eb-a124-42010a1e01f6","4ca42776-7546-11eb-a124-42010a1e01f6","4ca48478-7546-11eb-a124-42010a1e01f6","4ca42776-7546-11eb-a124-42010a1e01f6","4ca4a26e-7546-11eb-a124-42010a1e01f6","4ca4b236-7546-11eb-a124-42010a1e01f6","4ca4c0fa-7546-11eb-a124-42010a1e01f6","4ca4de3c-7546-11eb-a124-42010a1e01f6","4ca4ec38-7546-11eb-a124-42010a1e01f6","4ca4fdf4-7546-11eb-a124-42010a1e01f6","4ca50d08-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4ca52b8a-7546-11eb-a124-42010a1e01f6","4ca539a4-7546-11eb-a124-42010a1e01f6","4ca539a4-7546-11eb-a124-42010a1e01f6","4ca54868-7546-11eb-a124-42010a1e01f6","4ca54868-7546-11eb-a124-42010a1e01f6","4ca56672-7546-11eb-a124-42010a1e01f6","4ca57824-7546-11eb-a124-42010a1e01f6"],"to":["4c7bc664-7546-11eb-a124-42010a1e01f6","4c7bc664-7546-11eb-a124-42010a1e01f6","4c7bc664-7546-11eb-a124-42010a1e01f6","4c7bc664-7546-11eb-a124-42010a1e01f6","4c7ba5da-7546-11eb-a124-42010a1e01f6","4c7adeca-7546-11eb-a124-42010a1e01f6","4c7b8b0e-7546-11eb-a124-42010a1e01f6","4c7af05e-7546-11eb-a124-42010a1e01f6","4c7b0f44-7546-11eb-a124-42010a1e01f6","4c7b7c7c-7546-11eb-a124-42010a1e01f6","4c7b2ce0-7546-11eb-a124-42010a1e01f6","4c7b7c7c-7546-11eb-a124-42010a1e01f6","4c7b4e6e-7546-11eb-a124-42010a1e01f6","4c7b7c7c-7546-11eb-a124-42010a1e01f6","4c7b6dea-7546-11eb-a124-42010a1e01f6","4c7b7c7c-7546-11eb-a124-42010a1e01f6","4c7b8b0e-7546-11eb-a124-42010a1e01f6","4c7ba5da-7546-11eb-a124-42010a1e01f6","4c7bb4e4-7546-11eb-a124-42010a1e01f6","4c7bc664-7546-11eb-a124-42010a1e01f6","4c7bd640-7546-11eb-a124-42010a1e01f6","4ca52b8a-7546-11eb-a124-42010a1e01f6","4c826596-7546-11eb-a124-42010a1e01f6","4c826596-7546-11eb-a124-42010a1e01f6","4c826596-7546-11eb-a124-42010a1e01f6","4c826596-7546-11eb-a124-42010a1e01f6","4c82441c-7546-11eb-a124-42010a1e01f6","4c817f5a-7546-11eb-a124-42010a1e01f6","4c82273e-7546-11eb-a124-42010a1e01f6","4c818e6e-7546-11eb-a124-42010a1e01f6","4c81ac3c-7546-11eb-a124-42010a1e01f6","4c8217bc-7546-11eb-a124-42010a1e01f6","4c81ca3c-7546-11eb-a124-42010a1e01f6","4c8217bc-7546-11eb-a124-42010a1e01f6","4c81e828-7546-11eb-a124-42010a1e01f6","4c8217bc-7546-11eb-a124-42010a1e01f6","4c8207b8-7546-11eb-a124-42010a1e01f6","4c8217bc-7546-11eb-a124-42010a1e01f6","4c82273e-7546-11eb-a124-42010a1e01f6","4c82441c-7546-11eb-a124-42010a1e01f6","4c8252c2-7546-11eb-a124-42010a1e01f6","4c826596-7546-11eb-a124-42010a1e01f6","4c8274be-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4c949676-7546-11eb-a124-42010a1e01f6","4c949676-7546-11eb-a124-42010a1e01f6","4c949676-7546-11eb-a124-42010a1e01f6","4c949676-7546-11eb-a124-42010a1e01f6","4c9476e6-7546-11eb-a124-42010a1e01f6","4c93ad56-7546-11eb-a124-42010a1e01f6","4c945bd4-7546-11eb-a124-42010a1e01f6","4c93be68-7546-11eb-a124-42010a1e01f6","4c93dc2c-7546-11eb-a124-42010a1e01f6","4c944c52-7546-11eb-a124-42010a1e01f6","4c93ff18-7546-11eb-a124-42010a1e01f6","4c944c52-7546-11eb-a124-42010a1e01f6","4c941e6c-7546-11eb-a124-42010a1e01f6","4c944c52-7546-11eb-a124-42010a1e01f6","4c943d48-7546-11eb-a124-42010a1e01f6","4c944c52-7546-11eb-a124-42010a1e01f6","4c945bd4-7546-11eb-a124-42010a1e01f6","4c9476e6-7546-11eb-a124-42010a1e01f6","4c94855a-7546-11eb-a124-42010a1e01f6","4c949676-7546-11eb-a124-42010a1e01f6","4c94a5e4-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4c967b30-7546-11eb-a124-42010a1e01f6","4c967b30-7546-11eb-a124-42010a1e01f6","4c967b30-7546-11eb-a124-42010a1e01f6","4c967b30-7546-11eb-a124-42010a1e01f6","4c965934-7546-11eb-a124-42010a1e01f6","4c9597e2-7546-11eb-a124-42010a1e01f6","4c963de6-7546-11eb-a124-42010a1e01f6","4c95a764-7546-11eb-a124-42010a1e01f6","4c95c550-7546-11eb-a124-42010a1e01f6","4c962e46-7546-11eb-a124-42010a1e01f6","4c95e314-7546-11eb-a124-42010a1e01f6","4c962e46-7546-11eb-a124-42010a1e01f6","4c96007e-7546-11eb-a124-42010a1e01f6","4c962e46-7546-11eb-a124-42010a1e01f6","4c961e38-7546-11eb-a124-42010a1e01f6","4c962e46-7546-11eb-a124-42010a1e01f6","4c963de6-7546-11eb-a124-42010a1e01f6","4c965934-7546-11eb-a124-42010a1e01f6","4c966938-7546-11eb-a124-42010a1e01f6","4c967b30-7546-11eb-a124-42010a1e01f6","4c968a44-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4c985edc-7546-11eb-a124-42010a1e01f6","4c985edc-7546-11eb-a124-42010a1e01f6","4c985edc-7546-11eb-a124-42010a1e01f6","4c985edc-7546-11eb-a124-42010a1e01f6","4c983f24-7546-11eb-a124-42010a1e01f6","4c977b7a-7546-11eb-a124-42010a1e01f6","4c982340-7546-11eb-a124-42010a1e01f6","4c978b56-7546-11eb-a124-42010a1e01f6","4c97a960-7546-11eb-a124-42010a1e01f6","4c98149a-7546-11eb-a124-42010a1e01f6","4c97c882-7546-11eb-a124-42010a1e01f6","4c98149a-7546-11eb-a124-42010a1e01f6","4c97e678-7546-11eb-a124-42010a1e01f6","4c98149a-7546-11eb-a124-42010a1e01f6","4c98063a-7546-11eb-a124-42010a1e01f6","4c98149a-7546-11eb-a124-42010a1e01f6","4c982340-7546-11eb-a124-42010a1e01f6","4c983f24-7546-11eb-a124-42010a1e01f6","4c984cd0-7546-11eb-a124-42010a1e01f6","4c985edc-7546-11eb-a124-42010a1e01f6","4c987188-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4c9a507a-7546-11eb-a124-42010a1e01f6","4c9a507a-7546-11eb-a124-42010a1e01f6","4c9a507a-7546-11eb-a124-42010a1e01f6","4c9a507a-7546-11eb-a124-42010a1e01f6","4c9a30cc-7546-11eb-a124-42010a1e01f6","4c996c8c-7546-11eb-a124-42010a1e01f6","4c9a160a-7546-11eb-a124-42010a1e01f6","4c997d08-7546-11eb-a124-42010a1e01f6","4c999acc-7546-11eb-a124-42010a1e01f6","4c9a0750-7546-11eb-a124-42010a1e01f6","4c99b8e0-7546-11eb-a124-42010a1e01f6","4c9a0750-7546-11eb-a124-42010a1e01f6","4c99da0a-7546-11eb-a124-42010a1e01f6","4c9a0750-7546-11eb-a124-42010a1e01f6","4c99f828-7546-11eb-a124-42010a1e01f6","4c9a0750-7546-11eb-a124-42010a1e01f6","4c9a160a-7546-11eb-a124-42010a1e01f6","4c9a30cc-7546-11eb-a124-42010a1e01f6","4c9a3e8c-7546-11eb-a124-42010a1e01f6","4c9a507a-7546-11eb-a124-42010a1e01f6","4c9a5f98-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4c9c3e26-7546-11eb-a124-42010a1e01f6","4c9c3e26-7546-11eb-a124-42010a1e01f6","4c9c3e26-7546-11eb-a124-42010a1e01f6","4c9c3e26-7546-11eb-a124-42010a1e01f6","4c9c1d38-7546-11eb-a124-42010a1e01f6","4c9b565a-7546-11eb-a124-42010a1e01f6","4c9c028a-7546-11eb-a124-42010a1e01f6","4c9b6a5a-7546-11eb-a124-42010a1e01f6","4c9b8922-7546-11eb-a124-42010a1e01f6","4c9bf380-7546-11eb-a124-42010a1e01f6","4c9ba8e4-7546-11eb-a124-42010a1e01f6","4c9bf380-7546-11eb-a124-42010a1e01f6","4c9bc6f8-7546-11eb-a124-42010a1e01f6","4c9bf380-7546-11eb-a124-42010a1e01f6","4c9be516-7546-11eb-a124-42010a1e01f6","4c9bf380-7546-11eb-a124-42010a1e01f6","4c9c028a-7546-11eb-a124-42010a1e01f6","4c9c1d38-7546-11eb-a124-42010a1e01f6","4c9c2c1a-7546-11eb-a124-42010a1e01f6","4c9c3e26-7546-11eb-a124-42010a1e01f6","4c9c4e34-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4c9e2cd6-7546-11eb-a124-42010a1e01f6","4c9e2cd6-7546-11eb-a124-42010a1e01f6","4c9e2cd6-7546-11eb-a124-42010a1e01f6","4c9e2cd6-7546-11eb-a124-42010a1e01f6","4c9e0b84-7546-11eb-a124-42010a1e01f6","4c9d40e6-7546-11eb-a124-42010a1e01f6","4c9deeb0-7546-11eb-a124-42010a1e01f6","4c9d5022-7546-11eb-a124-42010a1e01f6","4c9d735e-7546-11eb-a124-42010a1e01f6","4c9de028-7546-11eb-a124-42010a1e01f6","4c9d928a-7546-11eb-a124-42010a1e01f6","4c9de028-7546-11eb-a124-42010a1e01f6","4c9db0bc-7546-11eb-a124-42010a1e01f6","4c9de028-7546-11eb-a124-42010a1e01f6","4c9dd114-7546-11eb-a124-42010a1e01f6","4c9de028-7546-11eb-a124-42010a1e01f6","4c9deeb0-7546-11eb-a124-42010a1e01f6","4c9e0b84-7546-11eb-a124-42010a1e01f6","4c9e1b24-7546-11eb-a124-42010a1e01f6","4c9e2cd6-7546-11eb-a124-42010a1e01f6","4c9e3bc2-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4ca11ea0-7546-11eb-a124-42010a1e01f6","4ca11ea0-7546-11eb-a124-42010a1e01f6","4ca11ea0-7546-11eb-a124-42010a1e01f6","4ca11ea0-7546-11eb-a124-42010a1e01f6","4c9ff124-7546-11eb-a124-42010a1e01f6","4c9f2dfc-7546-11eb-a124-42010a1e01f6","4c9fd50e-7546-11eb-a124-42010a1e01f6","4c9f3d06-7546-11eb-a124-42010a1e01f6","4c9f5c82-7546-11eb-a124-42010a1e01f6","4c9fc62c-7546-11eb-a124-42010a1e01f6","4c9f7a8c-7546-11eb-a124-42010a1e01f6","4c9fc62c-7546-11eb-a124-42010a1e01f6","4c9f99ea-7546-11eb-a124-42010a1e01f6","4c9fc62c-7546-11eb-a124-42010a1e01f6","4c9fb7c2-7546-11eb-a124-42010a1e01f6","4c9fc62c-7546-11eb-a124-42010a1e01f6","4c9fd50e-7546-11eb-a124-42010a1e01f6","4c9ff124-7546-11eb-a124-42010a1e01f6","4c9fff52-7546-11eb-a124-42010a1e01f6","4ca11ea0-7546-11eb-a124-42010a1e01f6","4ca1349e-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4ca314ee-7546-11eb-a124-42010a1e01f6","4ca314ee-7546-11eb-a124-42010a1e01f6","4ca314ee-7546-11eb-a124-42010a1e01f6","4ca314ee-7546-11eb-a124-42010a1e01f6","4ca2f4b4-7546-11eb-a124-42010a1e01f6","4ca22b9c-7546-11eb-a124-42010a1e01f6","4ca2d7b8-7546-11eb-a124-42010a1e01f6","4ca23bbe-7546-11eb-a124-42010a1e01f6","4ca25bda-7546-11eb-a124-42010a1e01f6","4ca2c80e-7546-11eb-a124-42010a1e01f6","4ca27b38-7546-11eb-a124-42010a1e01f6","4ca2c80e-7546-11eb-a124-42010a1e01f6","4ca29ab4-7546-11eb-a124-42010a1e01f6","4ca2c80e-7546-11eb-a124-42010a1e01f6","4ca2b968-7546-11eb-a124-42010a1e01f6","4ca2c80e-7546-11eb-a124-42010a1e01f6","4ca2d7b8-7546-11eb-a124-42010a1e01f6","4ca2f4b4-7546-11eb-a124-42010a1e01f6","4ca303c8-7546-11eb-a124-42010a1e01f6","4ca314ee-7546-11eb-a124-42010a1e01f6","4ca3245c-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4ca4fdf4-7546-11eb-a124-42010a1e01f6","4ca4fdf4-7546-11eb-a124-42010a1e01f6","4ca4fdf4-7546-11eb-a124-42010a1e01f6","4ca4fdf4-7546-11eb-a124-42010a1e01f6","4ca4de3c-7546-11eb-a124-42010a1e01f6","4ca4184e-7546-11eb-a124-42010a1e01f6","4ca4c0fa-7546-11eb-a124-42010a1e01f6","4ca42776-7546-11eb-a124-42010a1e01f6","4ca4477e-7546-11eb-a124-42010a1e01f6","4ca4b236-7546-11eb-a124-42010a1e01f6","4ca4663c-7546-11eb-a124-42010a1e01f6","4ca4b236-7546-11eb-a124-42010a1e01f6","4ca48478-7546-11eb-a124-42010a1e01f6","4ca4b236-7546-11eb-a124-42010a1e01f6","4ca4a26e-7546-11eb-a124-42010a1e01f6","4ca4b236-7546-11eb-a124-42010a1e01f6","4ca4c0fa-7546-11eb-a124-42010a1e01f6","4ca4de3c-7546-11eb-a124-42010a1e01f6","4ca4ec38-7546-11eb-a124-42010a1e01f6","4ca4fdf4-7546-11eb-a124-42010a1e01f6","4ca50d08-7546-11eb-a124-42010a1e01f6","4ca51bb8-7546-11eb-a124-42010a1e01f6","4ca52b8a-7546-11eb-a124-42010a1e01f6","4ca539a4-7546-11eb-a124-42010a1e01f6","4ca57824-7546-11eb-a124-42010a1e01f6","4ca54868-7546-11eb-a124-42010a1e01f6","4ca57824-7546-11eb-a124-42010a1e01f6","4ca56672-7546-11eb-a124-42010a1e01f6","4ca57824-7546-11eb-a124-42010a1e01f6","4ca58684-7546-11eb-a124-42010a1e01f6"],"label":["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"dot"},"manipulation":{"enabled":false},"edges":{"arrows":"to"},"layout":{"hierarchical":{"enabled":true,"levelSeparation":500,"nodeSpacing":200,"direction":"RL"}},"groups":{"useDefaultGroups":true,"none":{"color":{"border":"black","background":"white"}}}},"groups":["none"],"width":"90%","height":"400px","idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"background":"rgba(0, 0, 0, 0)"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="train-the-super-learner-on-the-machine-learning-task" class="section level3 unnumbered">
<h3>3. Train the Super Learner on the machine learning task<a class="anchor" aria-label="anchor" href="#train-the-super-learner-on-the-machine-learning-task"><i class="fas fa-link"></i></a>
</h3>
<p>The Super Learner algorithm fits a metalearner on the validation-set
predictions in a cross-validated manner, thereby avoiding overfitting.</p>
<p>Now we are ready to <strong>“train”</strong> our Super Learner on our <code>sl3_task</code> object,
<code>washb_task</code>.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sl_fit</span> <span class="op">&lt;-</span> <span class="va">sl</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">washb_task</span><span class="op">)</span></code></pre></div>
</div>
<div id="obtain-predicted-values" class="section level3 unnumbered">
<h3>4. Obtain predicted values<a class="anchor" aria-label="anchor" href="#obtain-predicted-values"><i class="fas fa-link"></i></a>
</h3>
<p>Now that we have fit the super learner, we are ready to calculate the predicted
outcome for each subject.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we did it! now we have super learner predictions</span>
<span class="va">sl_preds</span> <span class="op">&lt;-</span> <span class="va">sl_fit</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sl_preds</span><span class="op">)</span></code></pre></div>
<!--
Below we visualize the observed versus predicted values.

For fun, we will also
include the cross-validated predictions from most popular learner on the block,
main terms linear regression.



```r

# df_plot <- data.frame(
  Observed = washb_data$whz,
  Predicted = sl_preds,
  count = c(1:nrow(washb_data))
)

# df_plot_melted <- melt(df_plot,
  id.vars = "count",
  measure.vars = c("Observed", "Predicted")
)

# ggplot(df_plot_melted, aes(value, count, color = variable)) +
  geom_point()
```
-->
<p>We can also obtain a summary of the results.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sl_fit_summary</span> <span class="op">&lt;-</span> <span class="va">sl_fit</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>From the table of the printed Super Learner fit, we note that the Super Learner
had a mean risk of <code>sl_fit_summary$mean_risk[length(sl_fit_summary$learner)]</code>
and that this ensemble weighted the <code>ranger</code> and <code>glmnet</code> learners highest while
not weighting the <code>mean</code> learner highly.</p>
<p>We can also see that the <code>glmnet</code> learner had the lowest cross-validated mean
risk, thus making it the cross-validated selector (or the <em>discrete</em> Super
Learner). The mean risk of the Super Learner is calculated using the hold-out
set that we visualized in the <code>dt_sl</code> plot.</p>
</div>
</div>
<div id="cross-validated-super-learner" class="section level2 unnumbered">
<h2>Cross-validated Super Learner<a class="anchor" aria-label="anchor" href="#cross-validated-super-learner"><i class="fas fa-link"></i></a>
</h2>
<p>We can cross-validate the Super Learner to see how well the Super Learner
performs on unseen data, and obtain an estimate of the cross-validated risk of
the Super Learner.</p>
<p>This estimation procedure requires an “external” layer of cross-validation,
also called nested cross-validation, which involves setting aside a separate
holdout sample that we don’t use to fit the Super Learner. This
external cross validation procedure may also incorporate 10 folds, which is the
default in <code>sl3</code>. However, we will incorporate 2 outer/external folds of
cross-validation for computational efficiency.</p>
<p>We also need to specify a loss function to evaluate Super Learner.
Documentation for the available loss functions can be found in the <a href="https://tlverse.org/sl3/reference/loss_functions.html"><code>sl3</code> Loss
Function Reference</a>.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">washb_task_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/sl3_Task.html">make_sl3_Task</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">washb_data</span>,
  covariates <span class="op">=</span> <span class="va">covars</span>,
  outcome <span class="op">=</span> <span class="va">outcome</span>,
  folds <span class="op">=</span> <span class="fu">origami</span><span class="fu">::</span><span class="fu"><a href="http://tlverse.org/origami/reference/make_folds.html">make_folds</a></span><span class="op">(</span><span class="va">washb_data</span>, fold_fun <span class="op">=</span> <span class="va">folds_vfold</span>, V <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">CVsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/CV_lrnr_sl.html">CV_lrnr_sl</a></span><span class="op">(</span>
  lrnr_sl <span class="op">=</span> <span class="va">sl_fit</span>, task <span class="op">=</span> <span class="va">washb_task_new</span>, loss_fun <span class="op">=</span> <span class="va">loss_squared_error</span>
<span class="op">)</span>
<span class="va">CVsl</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kableExtra</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>fixed_thead <span class="op">=</span> <span class="cn">T</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/scroll_box.html">scroll_box</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="st">"300px"</span><span class="op">)</span></code></pre></div>
<!-- Explain summary!!!! -->
</div>
<div id="variable-importance-measures-with-sl3" class="section level2 unnumbered">
<h2>Variable Importance Measures with <code>sl3</code><a class="anchor" aria-label="anchor" href="#variable-importance-measures-with-sl3"><i class="fas fa-link"></i></a>
</h2>
<p>Variable importance can be interesting and informative. It can also be
contradictory and confusing. Nevertheless, we like it, and so do our
collaborators, so we created a variable importance function in <code>sl3</code>! The <code>sl3</code>
<code>importance</code> function returns a table with variables listed in decreasing order
of importance (i.e., most important on the first row).</p>
<p>The measure of importance in <code>sl3</code> is based on a risk ratio, or risk
difference, between the learner fit with a removed, or permuted, covariate and
the learner fit with the true covariate, across all covariates. In this manner,
the larger the risk difference, the more important the variable is in the
prediction.</p>
<p>The intuition of this measure is that it calculates the risk (in terms of the
average loss in predictive accuracy) of losing one covariate, while keeping
everything else fixed, and compares it to the risk if the covariate was not
lost. If this risk ratio is one, or risk difference is zero, then losing that
covariate had no impact, and is thus not important by this measure. We do this
across all of the covariates. As stated above, we can remove the covariate and
refit the Super Learner without it, or we just permute the covariate
(faster, more risky) and hope for the shuffling to distort any meaningful
information that was present in the covariate. This idea of permuting
instead of removing saves a lot of time, and is also incorporated in the
<code>randomForest</code> variable importance measures. However, the permutation approach
is risky, so the importance function default is to remove and refit.</p>
<p>Let’s explore the <code>sl3</code> variable importance measurements for the <code>washb</code> data.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">washb_varimp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/importance.html">importance</a></span><span class="op">(</span><span class="va">sl_fit</span>, loss <span class="op">=</span> <span class="va">loss_squared_error</span>, type <span class="op">=</span> <span class="st">"permute"</span><span class="op">)</span>
<span class="va">washb_varimp</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kableExtra</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>fixed_thead <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/scroll_box.html">scroll_box</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="st">"300px"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># plot variable importance</span>
<span class="fu"><a href="https://tlverse.org/sl3/reference/importance_plot.html">importance_plot</a></span><span class="op">(</span>
  <span class="va">washb_varimp</span>,
  main <span class="op">=</span> <span class="st">"sl3 Variable Importance for WASH Benefits Example Data"</span>
<span class="op">)</span></code></pre></div>
<!-- Explain summary!!!! -->
</div>
<div id="sl3-exercises" class="section level2">
<h2>
<span class="header-section-number">6.1</span> Exercises<a class="anchor" aria-label="anchor" href="#sl3-exercises"><i class="fas fa-link"></i></a>
</h2>
<div id="sl3ex1" class="section level3">
<h3>
<span class="header-section-number">6.1.1</span> Predicting Myocardial Infarction with <code>sl3</code><a class="anchor" aria-label="anchor" href="#sl3ex1"><i class="fas fa-link"></i></a>
</h3>
<p>Follow the steps below to predict myocardial infarction (<code>mi</code>) using the
available covariate data. We thank Prof. David Benkeser at Emory University for
making the this Cardiovascular Health Study (CHS) data accessible.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load the data set</span>
<span class="va">db_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
    <span class="st">"https://raw.githubusercontent.com/benkeser/sllecture/master/"</span>,
    <span class="st">"chspred.csv"</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">chspred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">db_data</span>, col_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># take a quick peek</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">chspred</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">kableExtra</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html">kable_styling</a></span><span class="op">(</span>fixed_thead <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/scroll_box.html">scroll_box</a></span><span class="op">(</span>width <span class="op">=</span> <span class="st">"100%"</span>, height <span class="op">=</span> <span class="st">"300px"</span><span class="op">)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:300px; overflow-x: scroll; width:100%; ">
<div class="inline-table"><table class="table" style="margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
waist
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
alcoh
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
hdl
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
beta
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
smoke
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
ace
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
ldl
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
bmi
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
aspirin
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
gend
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
age
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
estrgn
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
glu
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
ins
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
cysgfr
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
dm
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
fetuina
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
whr
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
hsed
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
race
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
logcystat
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
logtrig
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
logcrp
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
logcre
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
health
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
logkcal
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
sysbp
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;position: sticky; top:0; background-color: #FFFFFF;">
mi
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
110.164
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
66.497
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
114.216
</td>
<td style="text-align:right;">
27.997
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
73.518
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
159.931
</td>
<td style="text-align:right;">
70.3343
</td>
<td style="text-align:right;">
75.008
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.1752
</td>
<td style="text-align:right;">
1.1690
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.3420
</td>
<td style="text-align:right;">
5.4063
</td>
<td style="text-align:right;">
2.0126
</td>
<td style="text-align:right;">
-0.6739
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
4.3926
</td>
<td style="text-align:right;">
177.135
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
89.976
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
50.065
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
103.777
</td>
<td style="text-align:right;">
20.893
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
61.772
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
153.389
</td>
<td style="text-align:right;">
33.9695
</td>
<td style="text-align:right;">
82.743
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.5717
</td>
<td style="text-align:right;">
0.9011
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.0847
</td>
<td style="text-align:right;">
4.8592
</td>
<td style="text-align:right;">
3.2933
</td>
<td style="text-align:right;">
-0.5551
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
6.2071
</td>
<td style="text-align:right;">
136.374
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
106.194
</td>
<td style="text-align:right;">
8.4174
</td>
<td style="text-align:right;">
40.506
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
165.716
</td>
<td style="text-align:right;">
28.455
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
72.931
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
121.715
</td>
<td style="text-align:right;">
-17.3017
</td>
<td style="text-align:right;">
74.699
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.3517
</td>
<td style="text-align:right;">
1.1797
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
-0.4451
</td>
<td style="text-align:right;">
4.5088
</td>
<td style="text-align:right;">
0.3013
</td>
<td style="text-align:right;">
-0.0115
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
6.7320
</td>
<td style="text-align:right;">
135.199
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
90.057
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
36.175
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
45.203
</td>
<td style="text-align:right;">
23.961
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
79.119
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
53.969
</td>
<td style="text-align:right;">
11.7315
</td>
<td style="text-align:right;">
95.782
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.5439
</td>
<td style="text-align:right;">
1.1360
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.4807
</td>
<td style="text-align:right;">
5.1832
</td>
<td style="text-align:right;">
3.0243
</td>
<td style="text-align:right;">
-0.5751
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
7.3972
</td>
<td style="text-align:right;">
139.018
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
78.614
</td>
<td style="text-align:right;">
2.9790
</td>
<td style="text-align:right;">
71.064
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
131.312
</td>
<td style="text-align:right;">
10.966
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
69.018
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
94.315
</td>
<td style="text-align:right;">
9.7112
</td>
<td style="text-align:right;">
72.711
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.4916
</td>
<td style="text-align:right;">
1.1028
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0.3121
</td>
<td style="text-align:right;">
4.2190
</td>
<td style="text-align:right;">
-0.7057
</td>
<td style="text-align:right;">
0.0053
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
8.2779
</td>
<td style="text-align:right;">
88.047
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:right;">
91.659
</td>
<td style="text-align:right;">
0.0000
</td>
<td style="text-align:right;">
59.496
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
171.187
</td>
<td style="text-align:right;">
29.132
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
81.835
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
212.907
</td>
<td style="text-align:right;">
-28.2269
</td>
<td style="text-align:right;">
69.218
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.4621
</td>
<td style="text-align:right;">
0.9529
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
-0.2872
</td>
<td style="text-align:right;">
5.1773
</td>
<td style="text-align:right;">
0.9705
</td>
<td style="text-align:right;">
0.2127
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
5.9942
</td>
<td style="text-align:right;">
69.594
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table></div>
</div>
<ol style="list-style-type: decimal">
<li>Create an <code>sl3</code> task, setting myocardial infarction <code>mi</code> as the outcome and
using all available covariate data.</li>
<li>Make a library of seven relatively fast base learning algorithms (i.e., do
not consider BART or HAL). Customize hyperparameters for one of your
learners. Feel free to use learners from <code>sl3</code> or <code>SuperLearner</code>. You may
use the same base learning library that is presented above.</li>
<li>Incorporate feature selection with the screener <code>screen.corP</code>.</li>
<li>Fit the metalearning step with the default metalearner.</li>
<li>With the metalearner and base learners, make the Super Learner and train it
on the task.</li>
<li>Print your Super Learner fit by calling <code><a href="https://docs.ropensci.org/skimr/reference/print.html">print()</a></code> with <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code>.</li>
<li>Cross-validate your Super Learner fit to see how well it performs on unseen
data. Specify <code>loss_squared_error</code> as the loss function to evaluate the
Super Learner.</li>
<li>Use the <code><a href="https://tlverse.org/sl3/reference/importance.html">importance()</a></code> function to identify the most important predictor of
myocardial infarction.</li>
</ol>
</div>
<div id="sl3ex2" class="section level3">
<h3>
<span class="header-section-number">6.1.2</span> Predicting Recurrent Ischemic Stroke in an RCT with <code>sl3</code><a class="anchor" aria-label="anchor" href="#sl3ex2"><i class="fas fa-link"></i></a>
</h3>
<p>For this exercise, we will work with a random sample of 5,000 patients who
participated in the International Stroke Trial (IST). This data is described in
<a href="https://tlverse.org/tlverse-handbook/data.html#ist">Chapter 3.2 of the <code>tlverse</code>
handbook</a>.</p>
<ol style="list-style-type: decimal">
<li>Train a Super Learner to predict recurrent stroke <code>DRSISC</code> with the available
covariate data (the 25 other variables). Of course, you can consider feature
selection in the machine learning algorithms. In this data, the outcome is
occasionally missing, so be sure to specify <code>drop_missing_outcome = TRUE</code>
when defining the task.</li>
<li>Use the SL-based predictions to calculate the area under the ROC curve (AUC).</li>
<li>Calculate the cross-validated AUC to evaluate the performance of the
Super Learner on unseen data.</li>
<li>Which covariates are the most predictive of 14-day recurrent stroke,
according to <code>sl3</code> variable importance measures?</li>
</ol>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ist_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
  <span class="st">"https://raw.githubusercontent.com/tlverse/"</span>,
  <span class="st">"tlverse-handbook/master/data/ist_sample.csv"</span>
<span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># number 3 help</span>
<span class="va">ist_task_CVsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/sl3_Task.html">make_sl3_Task</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">ist_data</span>,
  outcome <span class="op">=</span> <span class="st">"DRSISC"</span>,
  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ist_data</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ist_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"DRSISC"</span><span class="op">)</span><span class="op">]</span>,
  drop_missing_outcome <span class="op">=</span> <span class="cn">TRUE</span>,
  folds <span class="op">=</span> <span class="fu">origami</span><span class="fu">::</span><span class="fu"><a href="http://tlverse.org/origami/reference/make_folds.html">make_folds</a></span><span class="op">(</span>
    n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ist_data</span><span class="op">$</span><span class="va">DRSISC</span><span class="op">)</span><span class="op">)</span>,
    fold_fun <span class="op">=</span> <span class="va">folds_vfold</span>,
    V <span class="op">=</span> <span class="fl">5</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<!--
## Super Learning of a Conditional Density

### Super learning of a conditional density

Suppose we want to construct a Super Learner of the conditional probability
distribution $g_0(a\mid W)=P_0(A=a\mid W)$, where $a\in {\cal A}$.
Let's denote the values of $a$ with $\{0,1,\ldots,K\}$. A valid loss function
for the conditional density is
\[
L(g)(O)=-\log g(A\mid W).\]
That is, $g_0=\arg\min_g P_0L(g)$, i.e., $g_0$ is the minimizer of the
expectation of the log-likelihood loss.

**Candidate estimators**

1. Candidate estimators based on multinomial logistic regression: To start
with, one can use existing parametric model based MLE and machine learning
algorithms in `R` that fit a multinomial regression. For example, parametric
model multinomial logistic regression is available in `R` so that one can
already build a rich library of such estimators based on  different candidate
parametric models. In addition, `polyclass()` is a multinomial logistic
regression machine learning algorithm in `R`.

2. Candidate estimators based on machine learning for multinomial logistic
regression: Secondly, one can use a machine learning algorithm such as
`polyclass()` in `R` that data adaptively fits a multinomial logistic
regression, which itself has tuning parameters, again generating a class of
candidate estimators.

3. Incorporating screening: Note that one can also marry any of these choices
with a screening algorithm, thereby creating more candidate estimators of
interest. The screening can be particularly important when there are many
variables.

4. Candidate estimators by fitting separate logistic regressions and using
post-normalization

* Code $A$ in terms of Bernoullis $B_k=I(A=k)$, $k=0,\ldots,K$.
* Construct an estimator $\bar{g}_{nk}$ of $\bar{g}_{0k}(W)\equiv P_0(B_k=1\mid
  W)$ using any of the logistic regression algorithms, for all $k=0,\ldots,K$.
* This implies an estimator
\[
g_n(a\mid W)=\frac{\bar{g}_{na}(W)}{\sum_{k=0}^K \bar{g}_{nk}(W)}.\]
* In other words, we simply normalize these separate logistic regression
estimators so that we obtain a valid conditional distribution.
* This generates an enormous amount of interesting algorithms, since we have
available the whole machine learning literature for binary outcome regression.

5. Candidate estimators by estimating the conditional "hazard" with pooled
logistic regression.
Note that
\[
g_0(a\mid W)=\lambda_0(a\mid W) S_0(a\mid W),\]
where \[
\lambda_0(a\mid W)=P_0(A=a\mid A\geq a,W),\]

and $S_0(a\mid W)=\prod_{s\leq a}(1-\lambda_0(s\mid W))$ is the conditional
survival function $P_0(A>a\mid W)$. So we have now parameterized the
conditional distribution of $A$, given $W$, by a conditional hazard
$\lambda_0(a\mid W)$: $g_0=g_{\lambda_0}$.

* We could now focus on constructing candidate estimators of
$\lambda_0(a\mid W)$, which implies candidate estimators of $g_0$.

* For every observation $A_i$, we can create $A_i+1$ rows of data
$(W,s,I(A_i=s))$, $s=0,\ldots,A_i$, $i=1,\ldots,n$. We now run a logistic
regression estimator based on the pooled data set, ignoring ID, where we
regress the binary outcome $I(A_i=s)$ on the covariates $(W,s)$.

* If one assumes a parametric model, then this is nothing else then using the
maximum likelihood estimator, demonstrating that ignoring the ID is not
inefficient.

* This defines now an estimator of $\lambda_0(s\mid W)=P_0(A=s\mid W,A\geq s)$
as a function of $(s,W)$.

* Different choices of logistic regression based estimators will define
different estimators.

* The pooling across $s$ is not very sensible if $A$ is not an ordered variable
If $A$ is categorical, we recommend to compute  a separate logistic regression
estimator of $\lambda_0(a\mid W)$ for each $a$ (i.e., stratify by $s$ in the
  above pooled data set).

* For non-categorical $A$, one could include both stratified (by level) as well
as pooled (across levels) based logistic regression estimators.


## Exercise 2 -- Estimating the Propensity Score with `sl3` {#sl3ex-pscore}

exercise where we can look at positivity and maybe modify target population,
address issues related to this

## Super Learning of an Optimal Individualized Treatment Rule

* Data $O=(W,A,Y)$, and nonparametric model \mathcal{M} potentially containing
assumptions on the conditional probability distribution of $A$ given $W$
$g_0(A\mid W)$.
* Target: Optimal treatment rule $\psi_0(W)=I(B_0(W)>0)$, where
$B_0(W)=E_0(Y\mid A=1,W)-E_0(Y\mid A=0,W)$, the conditional treatment effect.
* Possible loss function for $\psi_0$ is an IPCW-loss:
\[
L_{g_0}(\psi)=\frac{I(A=\psi(W))}{g(A\mid W)}Y.\]

Indeed, $\psi_0$ is the minimizer of $EL_{g_0}(\psi)$ over all rules $\psi$.
* Construct library of candidate estimators of $\psi_0=I(B_0>0)$. This can
include estimators based on plugging in an estimator of $B_0$.
* One could also include a candidate estimator $I(B_n>0)$ where $B_n$ is a
Super Learner of $B_0$, e.g. based on loss function
\[
L_{g_0}(B)=\big(\frac{2A-1}{/g(A\mid W)}Y-B(W)\big)^2\]
that directly targets $B_0=\arg\min_B P_0L_{g_0}(B)$. This loss function is
still a squared error loss but its minimized by the true $B_0$.
* Estimate $g_0$ if not known.
* Compute cross-validation selector:
\[
k_n=\arg\min_k E_{B_n}P_{n,B_n}^1 L_{\hat{g}(P_{n,B_n}^0)}
(\hat{\Psi}_k(P_{n,B_n}^0)).\]
where $B_n = \{0,1\}^n$ is used for a binary vector of $n$ defining sample
splits, where the validation sample is ${i:B_n(i) = 1}$ and ${i:B_n(i) = 0}$ is
the training sample. The empirical distribution $P_{n,B_n}^0$ corresponds to
the split $B_n$ of the training sample and the empirical distribution of the
validation sample is $P_{n,B_n}^1$.
* Super-learner of optimal rule $\psi_0$: $\hat{\Psi}_{k_n}(P_n)$.

## Exercise 3 -- Estimating the Blip {#sl3ex3}

-->
</div>
</div>
<div id="concluding-remarks" class="section level2">
<h2>
<span class="header-section-number">6.2</span> Concluding Remarks<a class="anchor" aria-label="anchor" href="#concluding-remarks"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>The general ensemble learning approach of Super Learner can be applied to a
diversity of estimation and prediction problems that can be defined by a loss
function.</p></li>
<li><p>We just discussed conditional mean estimation, outcome prediction and
variable importance. In future updates of this chapter, we will delve into
prediction of a conditional density, and the optimal individualized treatment
rule.</p></li>
<li>
<p>If we plug in the estimator returned by super learner into the target
parameter mapping, then we would end up with an estimator that has the same
bias as what we plugged in, and would not be asymptotically linear. It also
would not be a plug-in estimator or efficient.</p>
<ul>
<li>An asymptotically linear estimator is important to have, since
they converge to the estimand at <span class="math inline">\(\frac{1}{\sqrt{n}}\)</span> rate, and thereby permit
formal statistical inference (i.e. confidence intervals and <span class="math inline">\(p\)</span>-values).</li>
<li>Plug-in estimators of the estimand are desirable because they respect both
the local and global constraints of the statistical model (e.g. bounds), and
have they have better finite-sample properties.</li>
<li>An efficient estimator is optimal in the sense that it has the lowest
possible variance, and is thus the most precise. An estimator is efficient if
and only if is asymptotically linear with influence curve equal to the
canonical gradient. The canonical gradient is a mathematical object that is
specific to the target estimand, and it provides information on the level of
difficulty of the estimation problem. The canonical gradient is shown in the
chapters that follow. Practitioner’s do not need to know how to calculate a
canonical gradient in order to understand efficiency and use Targeted Maximum
Likelihood Estimation (TMLE). Metaphorically, you do not need to be Yoda in
order to be a Jedi.</li>
</ul>
</li>
<li><p>TMLE is a general strategy that succeeds in constructing efficient and
asymptotically linear plug-in estimators.</p></li>
<li><p>Super Learner is fantastic for pure prediction, and for obtaining an initial
estimate in the first step of TMLE, but we need the second step of TMLE to
have the desirable statistical properties mentioned above.</p></li>
<li><p>In the chapters that follow, we focus on the targeted maximum likelihood
estimator and the targeted minimum loss-based estimator, both referred to as
TMLE.</p></li>
</ul>
<!--
We could just plug-in the estimator returned by Super Learner; however, this is
problematic because the Super Learner estimators are trading off bias and
variance in an optimal way and as a result their bias is essentially the rate
of convergence of these algorithms, which is always slower than $1/\sqrt{n}$.
Therefore, if we plug-in the estimator returned by super learner into the
target parameter mapping, we would end up with an estimator which has the same
bias as what we plugged in, which is greater than $1/\sqrt{n}$. Thus, we end up
with an estimator which is not asymptotically normal, since it does not
converge to the estimand at $1/\sqrt{n}$ rate.

An asymptotically linear estimator has no meaningful bias ($ < 1/\sqrt{n}$),
and can be written as an empirical mean in first order of a function of the
data, the influence curve, plus some negligible remainder term. Once an
estimator is asymptotically linear with an influence curve it’s normally
distributed, so the standardized estimator converges to a normal distribution
with mean 0 and variance is the variance of the influence curve. Thus, it is
advantageous to construct asymptotically linear estimators since they permit
formal statistical inference. Among the class of regular asymptotically linear
estimators, there is an optimal estimator which is an efficient estimator, and
that’s the one with influence curve equal to the canonical gradient of the
path-wise derivative of the target parameter. The canonical gradient is the
direction of the path through the data distribution where the parameter is
steepest. An estimator is efficient if and only if is asymptotically linear
with influence curve equal to the canonical gradient. One can calculate the
canonical gradient with the statistical model and the statistical target
parameter.  Techniques for calculating the canonical gradient entail projecting
an initial gradient on the tangent space of the model at the particular
distribution in the model in which you want to calculate the canonical
gradient.

Now we know what it takes to construct an efficient estimator. Namely, we need
to construct an estimator which is asymptotically linear with influence curve
the canonical gradient. There are three general classes of estimators which
succeed in constructing asymptotically linear estimators: (1) the one-step
estimator, but it is not a plug-in estimator; (2) the targeted maximum
likelihood estimator, which is a Super Learner targeted towards the target
parameter and it is a plug-in estimator; and (3) estimating equation based
estimators, which use the canonical gradient but as an estimating function in
the target parameter. In the chapters that follow, we focus on the targeted
maximum likelihood estimator and the targeted minimum loss-based estimator,
both referred to as TMLE.
-->
</div>
<div id="appendix" class="section level2 unnumbered">
<h2>Appendix<a class="anchor" aria-label="anchor" href="#appendix"><i class="fas fa-link"></i></a>
</h2>
<div id="sl3ex1-sol" class="section level3">
<h3>
<span class="header-section-number">6.2.1</span> Exercise 1 Solution<a class="anchor" aria-label="anchor" href="#sl3ex1-sol"><i class="fas fa-link"></i></a>
</h3>
<p>Here is a potential solution to the <a href="sl3.html#sl3ex1"><code>sl3</code> Exercise 1 – Predicting Myocardial
Infarction with <code>sl3</code></a>.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">db_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span>
  <span class="st">"https://raw.githubusercontent.com/benkeser/sllecture/master/chspred.csv"</span>
<span class="op">)</span>
<span class="va">chspred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">db_data</span>, col_names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># make task</span>
<span class="va">chspred_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/sl3_Task.html">make_sl3_Task</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">chspred</span>,
  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">chspred</span><span class="op">)</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>,
  outcome <span class="op">=</span> <span class="st">"mi"</span>
<span class="op">)</span>

<span class="co"># make learners</span>
<span class="va">glm_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glm.html">Lrnr_glm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">lasso_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">ridge_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">enet_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="co"># curated_glm_learner uses formula = "mi ~ smoke + beta + waist"</span>
<span class="va">curated_glm_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glm_fast.html">Lrnr_glm_fast</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"smoke, beta, waist"</span><span class="op">)</span><span class="op">)</span>
<span class="va">mean_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_mean.html">Lrnr_mean</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span> <span class="co"># That is one mean learner!</span>
<span class="va">glm_fast_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glm_fast.html">Lrnr_glm_fast</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">ranger_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">svm_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_svm.html">Lrnr_svm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">xgb_learner</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_xgboost.html">Lrnr_xgboost</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>

<span class="co"># screening</span>
<span class="va">screen_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Lrnr_screener_corP</span><span class="op">)</span>
<span class="va">glm_pipeline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span><span class="va">Pipeline</span>, <span class="va">screen_cor</span>, <span class="va">glm_learner</span><span class="op">)</span>

<span class="co"># stack learners together</span>
<span class="va">stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span><span class="op">(</span>
  <span class="va">Stack</span>,
  <span class="va">glm_pipeline</span>, <span class="va">glm_learner</span>,
  <span class="va">lasso_learner</span>, <span class="va">ridge_learner</span>, <span class="va">enet_learner</span>,
  <span class="va">curated_glm_learner</span>, <span class="va">mean_learner</span>, <span class="va">glm_fast_learner</span>,
  <span class="va">ranger_learner</span>, <span class="va">svm_learner</span>, <span class="va">xgb_learner</span>
<span class="op">)</span>

<span class="co"># make and train super learner</span>
<span class="va">sl</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_sl.html">Lrnr_sl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>
  learners <span class="op">=</span> <span class="va">stack</span>
<span class="op">)</span>
<span class="va">sl_fit</span> <span class="op">&lt;-</span> <span class="va">sl</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">chspred_task</span><span class="op">)</span>
<span class="va">sl_fit</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span>

<span class="va">CVsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/CV_lrnr_sl.html">CV_lrnr_sl</a></span><span class="op">(</span><span class="va">sl_fit</span>, <span class="va">chspred_task</span>, <span class="va">loss_squared_error</span><span class="op">)</span>
<span class="va">CVsl</span>

<span class="va">varimp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/importance.html">importance</a></span><span class="op">(</span><span class="va">sl_fit</span>, <span class="va">loss_squared_error</span>, type <span class="op">=</span> <span class="st">"permute"</span><span class="op">)</span>
<span class="va">varimp</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tlverse.org/sl3/reference/importance_plot.html">importance_plot</a></span><span class="op">(</span>
    main <span class="op">=</span> <span class="st">"sl3 Variable Importance for Myocardial Infarction Prediction"</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="sl3ex2-sol" class="section level3">
<h3>
<span class="header-section-number">6.2.2</span> Exercise 2 Solution<a class="anchor" aria-label="anchor" href="#sl3ex2-sol"><i class="fas fa-link"></i></a>
</h3>
<p>Here is a potential solution to <a href="sl3.html#sl3ex2"><code>sl3</code> Exercise 2 – Predicting Recurrent
Ischemic Stroke in an RCT with <code>sl3</code></a>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ipa-tys.github.io/ROCR/">ROCR</a></span><span class="op">)</span> <span class="co"># for AUC calculation</span>

<span class="va">ist_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span>
  <span class="st">"https://raw.githubusercontent.com/tlverse/"</span>,
  <span class="st">"tlverse-handbook/master/data/ist_sample.csv"</span>
<span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/fread.html">fread</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># stack</span>
<span class="va">ist_task</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/sl3_Task.html">make_sl3_Task</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">ist_data</span>,
  outcome <span class="op">=</span> <span class="st">"DRSISC"</span>,
  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ist_data</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ist_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"DRSISC"</span><span class="op">)</span><span class="op">]</span>,
  drop_missing_outcome <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># learner library</span>
<span class="va">lrnr_glm</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glm.html">Lrnr_glm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">lrnr_lasso</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">lrnr_ridge</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="va">lrnr_enet</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glmnet.html">Lrnr_glmnet</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
<span class="va">lrnr_mean</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_mean.html">Lrnr_mean</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">lrnr_ranger</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_ranger.html">Lrnr_ranger</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="va">lrnr_svm</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_svm.html">Lrnr_svm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>
<span class="co"># xgboost grid</span>
<span class="va">grid_params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  max_depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span>, <span class="fl">8</span><span class="op">)</span>,
  eta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.15</span>, <span class="fl">0.3</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span><span class="va">grid_params</span>, KEEP.OUT.ATTRS <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">params_default</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>nthread <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html">getOption</a></span><span class="op">(</span><span class="st">"sl.cores.learners"</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">xgb_learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">grid</span>, MARGIN <span class="op">=</span> <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">params_tune</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">Lrnr_xgboost</span><span class="op">$</span><span class="va">new</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">params_default</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">params_tune</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">learners</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="va">xgb_learners</span>, <span class="va">lrnr_ridge</span>, <span class="va">lrnr_mean</span>, <span class="va">lrnr_lasso</span>,
  <span class="va">lrnr_glm</span>, <span class="va">lrnr_enet</span>, <span class="va">lrnr_ranger</span>, <span class="va">lrnr_svm</span>
<span class="op">)</span>,
recursive <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="co"># super learner</span>
<span class="va">sl</span> <span class="op">&lt;-</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_sl.html">Lrnr_sl</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va">learners</span><span class="op">)</span>
<span class="va">sl_fit</span> <span class="op">&lt;-</span> <span class="va">sl</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">ist_task</span><span class="op">)</span>

<span class="co"># AUC</span>
<span class="va">preds</span> <span class="op">&lt;-</span> <span class="va">sl_fit</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="op">)</span>
<span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/na.omit.data.table.html">na.omit</a></span><span class="op">(</span><span class="va">ist_data</span><span class="op">$</span><span class="va">DRSISC</span><span class="op">)</span><span class="op">)</span>
<span class="va">AUC</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/performance.html">performance</a></span><span class="op">(</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/prediction.html">prediction</a></span><span class="op">(</span><span class="va">sl_preds</span>, <span class="va">obs</span><span class="op">)</span>, measure <span class="op">=</span> <span class="st">"auc"</span><span class="op">)</span><span class="op">@</span><span class="va">y.values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/performance.html">performance</a></span><span class="op">(</span><span class="fu"><a href="http://ipa-tys.github.io/ROCR/reference/prediction.html">prediction</a></span><span class="op">(</span><span class="va">sl_preds</span>, <span class="va">obs</span><span class="op">)</span>, <span class="st">"tpr"</span>, <span class="st">"fpr"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># CVsl</span>
<span class="va">ist_task_CVsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/sl3_Task.html">make_sl3_Task</a></span><span class="op">(</span>
  data <span class="op">=</span> <span class="va">ist_data</span>,
  outcome <span class="op">=</span> <span class="st">"DRSISC"</span>,
  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">ist_data</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">ist_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">"DRSISC"</span><span class="op">)</span><span class="op">]</span>,
  drop_missing_outcome <span class="op">=</span> <span class="cn">TRUE</span>,
  folds <span class="op">=</span> <span class="fu">origami</span><span class="fu">::</span><span class="fu"><a href="http://tlverse.org/origami/reference/make_folds.html">make_folds</a></span><span class="op">(</span>
    n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">ist_data</span><span class="op">$</span><span class="va">DRSISC</span><span class="op">)</span><span class="op">)</span>,
    fold_fun <span class="op">=</span> <span class="va">folds_vfold</span>,
    V <span class="op">=</span> <span class="fl">5</span>
  <span class="op">)</span>
<span class="op">)</span>
<span class="va">CVsl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/CV_lrnr_sl.html">CV_lrnr_sl</a></span><span class="op">(</span><span class="va">sl_fit</span>, <span class="va">ist_task_CVsl</span>, <span class="va">loss_loglik_binomial</span><span class="op">)</span>
<span class="va">CVsl</span>

<span class="co"># sl3 variable importance plot</span>
<span class="va">ist_varimp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/importance.html">importance</a></span><span class="op">(</span><span class="va">sl_fit</span>, <span class="va">loss_loglik_binomial</span>, type <span class="op">=</span> <span class="st">"permute"</span><span class="op">)</span>
<span class="va">ist_varimp</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://tlverse.org/sl3/reference/importance_plot.html">importance_plot</a></span><span class="op">(</span>
    main <span class="op">=</span> <span class="st">"Variable Importance for Predicting Recurrent Ischemic Stroke"</span>
  <span class="op">)</span></code></pre></div>
<!--
### Exercise 3 Solution {#sl3ex3-sol}

Here's a potential solution to the (Exercise 3)[#sl3ex3].


```r
# TODO
```
-->

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="origami.html"><span class="header-section-number">5</span> Cross-validation</a></div>
<div class="next"><a href="tmle3.html"><span class="header-section-number">7</span> The TMLE Framework</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#sl3"><span class="header-section-number">6</span> Super (Machine) Learning</a></li>
<li><a class="nav-link" href="#learning-objectives-3">Learning Objectives</a></li>
<li><a class="nav-link" href="#motivation">Motivation</a></li>
<li>
<a class="nav-link" href="#introduction-2">Introduction</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#background-1">Background</a></li></ul>
</li>
<li>
<a class="nav-link" href="#sl3-microwave-dinner-implementation">sl3 “Microwave Dinner” Implementation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#wash-benefits-study-example-1">WASH Benefits Study Example</a></li>
<li><a class="nav-link" href="#load-the-necessary-libraries-and-data">0. Load the necessary libraries and data</a></li>
<li><a class="nav-link" href="#define-the-machine-learning-task">1. Define the machine learning task</a></li>
<li><a class="nav-link" href="#make-a-super-learner">2. Make a Super Learner</a></li>
<li><a class="nav-link" href="#train-the-super-learner-on-the-machine-learning-task">3. Train the Super Learner on the machine learning task</a></li>
<li><a class="nav-link" href="#obtain-predicted-values">4. Obtain predicted values</a></li>
</ul>
</li>
<li><a class="nav-link" href="#cross-validated-super-learner">Cross-validated Super Learner</a></li>
<li><a class="nav-link" href="#variable-importance-measures-with-sl3">Variable Importance Measures with sl3</a></li>
<li>
<a class="nav-link" href="#sl3-exercises"><span class="header-section-number">6.1</span> Exercises</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sl3ex1"><span class="header-section-number">6.1.1</span> Predicting Myocardial Infarction with sl3</a></li>
<li><a class="nav-link" href="#sl3ex2"><span class="header-section-number">6.1.2</span> Predicting Recurrent Ischemic Stroke in an RCT with sl3</a></li>
</ul>
</li>
<li><a class="nav-link" href="#concluding-remarks"><span class="header-section-number">6.2</span> Concluding Remarks</a></li>
<li>
<a class="nav-link" href="#appendix">Appendix</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#sl3ex1-sol"><span class="header-section-number">6.2.1</span> Exercise 1 Solution</a></li>
<li><a class="nav-link" href="#sl3ex2-sol"><span class="header-section-number">6.2.2</span> Exercise 2 Solution</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/tlverse/tlverse-handbook/blob/master/06-sl3.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/tlverse/tlverse-handbook/edit/master/06-sl3.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Targeted Learning in R</strong>: Causal Data Science with the tlverse Software Ecosystem" was written by Mark van der Laan, Jeremy Coyle, Nima Hejazi, Ivana Malenica, Rachael Phillips, Alan Hubbard. It was last built on February 22, 2021.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
